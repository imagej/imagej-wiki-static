<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>Fijiyama - ImageJ</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Fijiyama","wgTitle":"Fijiyama","wgCurRevisionId":45644,"wgRevisionId":45644,"wgArticleId":11195,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Plugins","Registration","Citable"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Fijiyama","wgRelevantArticleId":11195,"wgRequestId":"383bbb8da1a7a59ccd45731b","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgPreferredVariant":"en","fancytree_path":"/extensions/TreeAndMenu/fancytree"});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user.cssprefs":"ready","user":"ready","user.options":"loading","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","skins.erudite":"ready"});mw.loader.implement("user.options@0j3lz3q",function($,jQuery,require,module){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens@1ku9xth",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["mediawiki.page.startup"]);});</script>
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%252Cshared%257Cmediawiki.sectionAnchor%257Cskins.erudite&amp;only=styles&amp;skin=erudite.css"/>
<script async="" src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=erudite"></script>
<link rel="stylesheet" href="extensions/TreeAndMenu/fancytree/fancytree.css"/><link rel="stylesheet" href="extensions/TreeAndMenu/suckerfish/suckerfish.css"/>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=erudite.css"/>
<meta name="generator" content="MediaWiki 1.28.0"/>
<meta name="description" content="Current Fijiyama version&amp;#160;: Gorgeous Grapevine (last release&amp;#160;: March 21th, 2020)."/>
<link rel="shortcut icon" href="skins/ij2.ico"/>
	<meta property="og:type" content="article"/>

	<meta property="og:site_name" content="ImageJ"/>

	<meta property="og:title" content="Fijiyama"/>

	<meta property="og:description" content="Current Fijiyama version&amp;#160;: Gorgeous Grapevine (last release&amp;#160;: March 21th, 2020)."/>


<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Fijiyama rootpage-Fijiyama skin-erudite action-view">
		<div class="mw-jump">
			<a href="Fijiyama.html#bodyContent">Skip to content</a>, 			<a href="Fijiyama.html#search">Skip to search</a>
		</div>

		<div id="top-wrap" role="banner">
			<h1><a href="Welcome" title="ImageJ" rel="home">ImageJ</a></h1>
			<div id="tagline">From ImageJ</div>

			<a id="menubutton" href="Fijiyama.html#menu">Menu</a>
			<div id="nav" role="navigation">
			<ul id='menu'>
<li id="menu-item-n-About"><a href="ImageJ">About</a></li>
<li id="menu-item-n-Downloads"><a href="Downloads">Downloads</a></li>
<li id="menu-item-n-Learn"><a href="Learn">Learn</a></li>
<li id="menu-item-n-Develop"><a href="Development">Develop</a></li>
<li id="menu-item-n-News"><a href="News">News</a></li>
<li id="menu-item-n-Events"><a href="Events">Events</a></li>
<li id="menu-item-n-Help"><a href="Help">Help</a></li>
</ul>
			</div>
		</div>

		<div id="mw-js-message"></div>
		
		<div id="main" role="main">

			<div id="bodyContent">
				<h1>Fijiyama</h1>
				
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><table class="infobox" cellspacing="5" style="max-width: 31em; font-size: 90%; text-align: left; float: right; border: 1px solid #a0a0a0;">
<tr>
<th colspan="2" style="text-align: center; font-size: 130%;"> <div style="float: left"></div>Fijiyama (Fiji)<div style="clear: left;"></div>
</th></tr>
<tr>
<th> Author
</th>
<td> Romain Fernandez &amp; Cédric Moisy
</td></tr>




<tr>
<th> Maintainer
</th>
<td> Romain Fernandez
</td></tr>


<tr>
<th> Source
</th>
<td> <a rel="nofollow" class="external text" href="https://github.com/Rocsg/Fijiyama/">on GitHub</a>
</td></tr>
<tr>
<th> Initial release
</th>
<td> February 10<sup>th</sup>, 2020
</td></tr>

<tr>
<th> Development status
</th>
<td> stable, active
</td></tr>
<tr>
<th> Category
</th>
<td> <a href="./Category:Registration" title="Category:Registration">Registration</a>
</td></tr>

</table>
<p><br />
</p><p><i>Current Fijiyama version&#160;: Gorgeous Grapevine (last release&#160;: March 21<sup>th</sup>, 2020).</i>
</p><p>The plugin <b>Fijiyama</b> (Yet Another Matching and Alignment tool for Fiji) is a generic tool for registration and alignment of 3D image series collected from various imaging modalities (MRI, X-rays, Microscopy, Photography, ...).
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Fijiyama.html#Multi-modal_time-series_registration"><span class="tocnumber">1</span> <span class="toctext">Multi-modal time-series registration</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="Fijiyama.html#Dataset_with_DOI_for_testing_purpose"><span class="tocnumber">2</span> <span class="toctext">Dataset with DOI for testing purpose</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="Fijiyama.html#Demo"><span class="tocnumber">3</span> <span class="toctext">Demo</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="Fijiyama.html#Plugin_features"><span class="tocnumber">4</span> <span class="toctext">Plugin features</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="Fijiyama.html#Installation"><span class="tocnumber">5</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="Fijiyama.html#Preparing_your_data"><span class="tocnumber">6</span> <span class="toctext">Preparing your data</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="Fijiyama.html#The_registration_manager_window"><span class="tocnumber">7</span> <span class="toctext">The registration manager window</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="./Fijiyama.html#Tutorial_1_:_Two_images_registration"><span class="tocnumber">8</span> <span class="toctext">Tutorial 1&#160;: Two images registration</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="./Fijiyama.html#Tutorial_2_:_Multimodal_time-series_registration"><span class="tocnumber">9</span> <span class="toctext">Tutorial 2&#160;: Multimodal time-series registration</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="Fijiyama.html#Complementary_features"><span class="tocnumber">10</span> <span class="toctext">Complementary features</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="Fijiyama.html#Compose_transformations"><span class="tocnumber">10.1</span> <span class="toctext">Compose transformations</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="Fijiyama.html#Apply_a_transformation_to_a_3d.2F4d.2F5d_Image"><span class="tocnumber">10.2</span> <span class="toctext">Apply a transformation to a 3d/4d/5d Image</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="Fijiyama.html#Versatility_Tests"><span class="tocnumber">11</span> <span class="toctext">Versatility Tests</span></a></li>
<li class="toclevel-1 tocsection-14"><a href="Fijiyama.html#Accuracy_Test"><span class="tocnumber">12</span> <span class="toctext">Accuracy Test</span></a></li>
<li class="toclevel-1 tocsection-15"><a href="Fijiyama.html#Versions_of_Fijiyama"><span class="tocnumber">13</span> <span class="toctext">Versions of Fijiyama</span></a></li>
<li class="toclevel-1 tocsection-16"><a href="Fijiyama.html#Possible_issues_and_recommendations"><span class="tocnumber">14</span> <span class="toctext">Possible issues and recommendations</span></a></li>
<li class="toclevel-1 tocsection-17"><a href="Fijiyama.html#The_maths_behind"><span class="tocnumber">15</span> <span class="toctext">The maths behind</span></a>
<ul>
<li class="toclevel-2 tocsection-18"><a href="Fijiyama.html#Transformations"><span class="tocnumber">15.1</span> <span class="toctext">Transformations</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="Fijiyama.html#Optimizers"><span class="tocnumber">15.2</span> <span class="toctext">Optimizers</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-20"><a href="Fijiyama.html#Limitations"><span class="tocnumber">16</span> <span class="toctext">Limitations</span></a></li>
<li class="toclevel-1 tocsection-21"><a href="Fijiyama.html#Citing_this_work"><span class="tocnumber">17</span> <span class="toctext">Citing this work</span></a></li>
<li class="toclevel-1 tocsection-22"><a href="Fijiyama.html#Contact"><span class="tocnumber">18</span> <span class="toctext">Contact</span></a></li>
<li class="toclevel-1 tocsection-23"><a href="Fijiyama.html#References"><span class="tocnumber">19</span> <span class="toctext">References</span></a></li>
<li class="toclevel-1 tocsection-24"><a href="Fijiyama.html#Software_dependencies_acknowledgements"><span class="tocnumber">20</span> <span class="toctext">Software dependencies acknowledgements</span></a></li>
<li class="toclevel-1 tocsection-25"><a href="Fijiyama.html#License"><span class="tocnumber">21</span> <span class="toctext">License</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Multi-modal_time-series_registration">Multi-modal time-series registration</span></h2>
<p><b>Context:</b> 3D images acquired with various imaging devices or during monitoring experiments often come with different orientations and positions, making it difficult to analyze. Fixing this misalignment in 2D is difficult and become intractable in 3D. In addition, as each modality highlights different structures, images from multiple devices can be very dissimilar. In this situation, structures and phenomenon analysis can be compromised.
</p><p><b>Goal:</b> Fijiyama aims to address these issues by helping users <b>to register, align and combine multi-modal 3D images or time-series in a unique reference geometry</b>. After registration, stacks are combined in a coherent multi-modal and/or multi-time volume that can be explored using the ImageJ viewer.
</p><p><b>Versatility:</b> Fijiyama is a generic tool, efficient at any scale, tissue or imaging modality. It has been tested on the most common imaging approaches in biology and medicine: MRI, X-rays, photography...
</p><p><a href="./File:Reg_present_1.png" class="image"><img alt="Reg present 1.png" src="_images/c/c4/Reg_present_1.png" width="700" height="432" /></a>
</p>
<h2><span class="mw-headline" id="Dataset_with_DOI_for_testing_purpose">Dataset with DOI for testing purpose</span></h2>
<p>A comprehensive dataset can be found at <a rel="nofollow" class="external text" href="https://zenodo.org/record/3695736#.Xl6JaEpCdhE">this link</a> on dryad.
</p>
<h2><span class="mw-headline" id="Demo">Demo</span></h2>
<p>The following video shows an example of Fijiyama application: the registration of two stacks of MRI 3D images, collected on a grapevine cutting at different dates(see the "Training tutorial" for details).
</p><p><iframe width="480" height="355" src="https://www.youtube.com/embed/QG_i50XJRfc" frameborder="0" allowfullscreen></iframe>
</p>
<h2><span class="mw-headline" id="Plugin_features">Plugin features</span></h2>
<ul><li> Two images registration (training / settings mode)</li>
<li> N-times / M-modalities 3D series registration</li>
<li> Composition of successive ITK transformations into a single transformation</li>
<li> Transformation of a 3D image (or a 4D / 5D hyperimage) with an ITK transformation</li></ul>
<p>In order to address the complex task of multi-modal registration, computation is based on the Block Matching algorithm (Ourselin <i>et al.</i>, 2000), a generic purpose registration algorithm, developed in the field of medical imaging. Algorithms from ITK and Simple ITK (Elastix algorithms) are available in the plugin as an option. To learn more about the algorithmic bases of the plugin, see section "The maths behind".
</p>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>In order to install Fijiyama on your computer, please follow these simple steps:
</p><p>1. (if needed) Download and install Fiji from <a rel="nofollow" class="external free" href="https://fiji.sc/">https://fiji.sc/</a>&#160;; start Fiji, and let it automatically update. Then restart Fiji.  
</p><p>2. Open Fiji, run the <b>Update manager</b> (Help &gt; Update). Click on "OK" to close the first popup windows, then click on the button <b>Manage update sites...</b>. 
</p><p>3. In this list, activate <b>ImageJ-ITK</b> by checking the corresponding checkboxes. 
</p><p>and add the <b>Fijiyama</b> repository (by clicking on the button <b>Add update site</b>, and filling the fields&#160;: name = "Fijiyama", site = <a rel="nofollow" class="external free" href="https://sites.imagej.net/Fijiyama">https://sites.imagej.net/Fijiyama</a>), then check the associated checkbox. 
</p><p>4. Restart Fiji: a new <b>Fijiyama</b> entry should be available in the menu Plugins &gt; Registration. If not, go back to the Update Manager, and check that the repositories <b>ImageJ-ITK</b>, and <b>Fijiyama</b> are correctly selected.
</p><p><br />
The following video shows a tutorial for Fijiyama installation:
</p><p><iframe width="480" height="355" src="https://www.youtube.com/embed/scm6UPlfgzU" frameborder="0" allowfullscreen></iframe>
</p>
<h2><span class="mw-headline" id="Preparing_your_data">Preparing your data</span></h2>
<p>In order to register your data, Fijiyama needs properly formatted dataset:
</p>
<ul><li> For two images pairwise registration&#160;: <b>Two 3D stacks/images</b> of the same object. Use your own data or the provided example datasets here: <a rel="nofollow" class="external text" href="_images/f/fd/Test_dataset_01_vine_crops.zip">case study 1, two-images registration</a></li>
<li> For series registration&#160;: <b>N 3D stacks/images</b> of the same object. Use your own data or the provided example datasets here: <a rel="nofollow" class="external text" href="_images/c/c8/Test_dataset_04_time_series.zip">case study 4, times series registration</a>.</li>
<li> <b>An empty "Output" directory</b>, that will be used to store the Fijiyama configuration file, the intermediate results (transformations) and the final results (transformations and resulting 3D images). The configuration file (*.fjm) keep a full track of your work. When saving the current registration experiment, Fijiyama stores the successive registration steps and the associated computed files. When restarting later from this point, you can review the whole process, and "undo" one or more steps.</li></ul>
<p><br />
Before starting registration, check your images calibration:
</p>
<ul><li> <b>Intensities: </b> verify there is a proper contrast between your object of interest and the background when opened in Fiji/ImageJ. If needed, use Image &gt; Adjust &gt; Brightness  / Contrast, and set the min and max values, then close the Brightness / Contrast window.</li>
<li> <b>Voxel sizes: </b> using ImageJ, check the image properties (Image &gt; Properties...) and correct the 4 central values, if needed. Unit of length <b>should have another value than "pixel" </b> (it can be "mm", "cm", "µm" for example). Check coherence of pixel width / height / depth according to your unit of length. If needed, open the "info" menu (Image &gt; Show info...), to get dicom parameters, or any other parameters. To visualize if the voxel depth is coherent with the pixel size, along X and Y axis, you can render your object as a 3D volume using the 3D viewer (plugins &gt; 3D viewer).</li></ul>
<p>Once signal intensity and voxel sizes have been checked, save your modified images. Then run Fijiyama, and select the <b>two images registration</b> mode or the <b>series registration</b> mode.
</p>
<h2><span class="mw-headline" id="The_registration_manager_window">The registration manager window</span></h2>
<div class="thumb tright"><div class="thumbinner" style="width:352px;"><a href="./File:Fijiyama_reg_manager.png" class="image"><img alt="Fijiyama reg manager.png" src="_images/5/53/Fijiyama_reg_manager.png" width="350" height="389" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="./File:Fijiyama_reg_manager.png" class="internal" title="Enlarge"></a></div></div></div></div>
<p>Once a registration scenario starts, you can interact with the registration manager window through (see image)&#160;:
</p>
<ul><li> The log window&#160;: a guide to remember last operations, and to understand what the plugin expects from you</li></ul>
<ul><li> The settings menus and buttons&#160;: useful to set the parameters of the future action</li></ul>
<ul><li> The action buttons&#160;: the first line (<b>Start</b>, <b>Abort</b>, and <b>Undo</b>) drives the lifecycle of the current action, defined by the menus and the current settings. <b>Save</b> can be used to save the progress made in the registration, as a "checkpoint". <b>Export</b> computes the resulting aligned 3D images, according with the succession of transformations performed. <b>Help</b> can be used at any time to open a contextual help message.</li></ul>
<ul><li> The actions list&#160;: stores the successive steps accomplished during the registration process.</li></ul>
<h2><span class="mw-headline" id="Tutorial_1_:_Two_images_registration">Tutorial 1&#160;: Two images registration</span></h2>
<p>In order to achieve an efficient registration of two 3D images, we recommend the following procedure:
</p>
<ul><li> <b>Step 1&#160;: </b> Prepare your data or download the example set: <a rel="nofollow" class="external text" href="_images/f/fd/Test_dataset_01_vine_crops.zip">case study 1, two-images registration</a></li>
<li> <b>Step 2&#160;: </b> Select '<b>Manual registration'</b> in the first menu and run it. Superimpose roughly the two volumes manually (centers should be roughly aligned, with angle &lt; 15 degrees). Press on '<b>Position ok'</b> (green button) when ready. This first step will help Fijiyama finding the correct orientation. </li>
<li> <b>Step 3&#160;: </b> Select '<b>Automatic registration'</b> with default parameters (Block matching). If you want to monitor the registration during the run, select the '<b>Display automatic registration'</b> in the “Manual registration viewer” menu. Before starting this action, notice the <i>estimated time</i> required to complete the action (calculated from your computer settings).</li>
<li> <b>Step 3-bis </b>(optional, depending on the data)&#160;:  Select '<b>Automatic registration'</b> with default parameters (Block matching), and select "Vector field" in the "Transformation to estimate" menu.</li>
<li> <b>Step 4&#160;: </b> Select '<b>Align both images with XYZ'</b> with default parameters. Turn the scene to improve its orientation, if needed for a more convenient representation of your data (production of figures or analyses). In the example dataset, we choose to align the red cylinder with the white lines (Z axis), and align the wounding point (a hole in the surface) with the axis X or Y.</li>
<li> <b>Step 5&#160;: </b> Save the final transformation using the '<b>Save current state'</b> button.</li>
<li> <b>Step 6&#160;: </b> Export the registered 3D images in the “output/Exported_data” directory previously selected, using the '<b>Export results'</b> button.</li></ul>
<h2><span class="mw-headline" id="Tutorial_2_:_Multimodal_time-series_registration">Tutorial 2&#160;: Multimodal time-series registration</span></h2>
<p>Once comfortable with the "two images registration" module, try a “series registration” following these steps. If you feel lost, you can rely on the tutorial here&#160;:
</p><p><iframe width="480" height="355" src="https://www.youtube.com/embed/DVr3LBH5ayY" frameborder="0" allowfullscreen></iframe>
</p>
<ul><li> <b>Step 1&#160;: </b> Prepare your data or download the example data set&#160;: <a rel="nofollow" class="external text" href="_images/c/c8/Test_dataset_04_time_series.zip">case study 4, times series registration</a></li></ul>
<p>Data names should respect a generic form, for example&#160;: img_t{Time}_mod{ModalityName}.tif , where {Time} represents the successive values for each time point, and {ModalityName} represents the name of each modality.
In the example dataset, this is already done, since the image names are&#160;: MRI_D0.tif , MRI_D1.tif , MRI_D2.tif , MRI_D3.tif, which corresponds to a monomodal series with the generic expression MRI_D{Time}.tif .
</p>
<ul><li> <b>Step 2&#160;: </b> Use the "Two images" training module to identify the best pipeline of actions for registering your images, from a modality to another, or from an observation time to another. </li>
<li> <b>Step 3&#160;: </b> Start the module '<b>Series registration'</b>, and follow the instructions. The manager will ask the pipeline for inter-time registration, then for inter-modalities registration. Once done, it will compose these steps into a full pipeline and process. You can repeatedly press on '<b>start this action'</b>, and execute all the steps.</li>
<li> <b>Step 4&#160;: </b> Once all actions needing human intervention are performed, use the '<b>Chain run'</b> button to ask Fijiyama to execute successively all the steps automatically.</li>
<li> <b>Step 5&#160;: </b> Run the last actions. The manual alignment step will set the reference geometry in the image axis, and the save and export steps will stores the actions and the results. The results are saved in the <i>output/Exported_data</i> directory.</li></ul>
<h2><span class="mw-headline" id="Complementary_features">Complementary features</span></h2>
<h3><span class="mw-headline" id="Compose_transformations">Compose transformations</span></h3>
<p>Chaining linear and/or dense transformations is one of the plugin core features for series processing. This function can also be used as a helper.
<br />
Guessing you already computed&#160;:
</p>
<ul><li> the transform T12 that aligned  Image1.tif with Image2.tif</li>
<li> the transform T23 that aligned  Image2.tif with Image3.tif</li></ul>
<p>You may want to align Image1 with Image3 in order to compare the three 3D images altogether. However, applying successive transformations will result in a strong blurring effect. In order to avoid this blur, you may want to combine the two transformation steps into a single one. 
</p><p>Use the <b>compose transformations function</b> to run in one go the successive transformations to be composed (in the example T12 then T23), and produce the resulting combined transform.
</p>
<h3><span class="mw-headline" id="Apply_a_transformation_to_a_3d.2F4d.2F5d_Image">Apply a transformation to a 3d/4d/5d Image</span></h3>
<p>This module is a helper function to apply an ITK transformation to a 3D image. Since the Gorgeous Grapevine version, this function can be applied to a 4D/5D hyperimage, the transformation being interpreted as a 3D transformation, and applied to each channel / frame of the hyperimage before the transformed 3d images are gathered back in an hyperstack).
</p>
<h2><span class="mw-headline" id="Versatility_Tests">Versatility Tests</span></h2>
<p>Fijiyama plugin has been tested on several data (including vegetal and human tissues), at different scales (from micro to macro imaging), and on different imaging modalities (microscopy, MRI, X-rays, and photographies). 
</p><p>See an example in the video below&#160;: Human abdomen CT-scan and MRI registration
(Courtesy of Dr. Samuel Mérigeaud, Tridilogy SARL)
<iframe width="480" height="355" src="https://www.youtube.com/embed/ETCnWIqoDI0" frameborder="0" allowfullscreen></iframe>
</p>
<h2><span class="mw-headline" id="Accuracy_Test">Accuracy Test</span></h2>
<p>Fijiyama can be used to quantify the resulting mismatch. This measurement process is integrated in the plugin as an extra functionality, to help users evaluating their results, as illustrated in this video&#160;: “Fijiyama&#160;: quantifying average mismatch after registration” 
</p><p><iframe width="480" height="355" src="https://www.youtube.com/embed/xTOQIHieH0o" frameborder="0" allowfullscreen></iframe>
</p>
<h2><span class="mw-headline" id="Versions_of_Fijiyama">Versions of Fijiyama</span></h2>
<p>Fijiyama is a living project, with frequent updates. Thanks to the Fiji updater, your version is updated each time the Fiji update starts.
</p><p>Major updates include new features released, or major refactoring, while minor updates (change in the release time) should not modify deeply the behaviour of the plugin, to keep results reproducible. These information can be seen in the launching interface of Fijiyama.
</p><p>Major updates are symbolized with a change in the plugin version name.
For minor updates, only the release time is modified.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:702px;"><a href="./File:Versioning_Fijiyama.jpeg" class="image"><img alt="Versioning Fijiyama.jpeg" src="_images/b/b3/Versioning_Fijiyama.jpeg" width="700" height="301" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="./File:Versioning_Fijiyama.jpeg" class="internal" title="Enlarge"></a></div></div></div></div></div>
<p><br />
</p>
<table class="wikitable">
<tr>
<td> <b>Version name</b>
</td>
<td> <b>First release</b>
</td>
<td> <b>Last release</b>
</td>
<td> <b>Integration of new features</b>
</td>
<td> <b>Modifications causing reproducibility issues</b>
</td></tr>
<tr>
<td> <b>Elastic Eucalyptus</b>
</td>
<td> 2020/02/10
</td>
<td> 2020/02/20
</td>
<td> Integration of the multimodal series registration feature. Redefinition of default settings in the settings editor.
</td>
<td> Default settings changes in the settings editor
</td></tr>
<tr>
<td> <b>Felicity Ficus</b>
</td>
<td> 2020/02/20
</td>
<td> 2020/03/02
</td>
<td> Integration of the time-lapse multimodal series feature. Versioning of serialized files
</td>
<td> 1th march: versioning of serialized files starts. Previously serialized files are then open with default values for level min, level max and block matching iterations.
</td></tr>
<tr>
<td> <b>Gorgeous grapevine</b>
</td>
<td> 2020/03/20
</td>
<td> 2020/03/20
</td>
<td> Hyperimage support (registration of 4D / 5D multi-channels or multi-time images
</td></tr>
<tr>
<td> <b>Handsome Honeysuckle (Future release) </b>
</td>
<td> Mid-june 2020
</td>
<td> ...
</td>
<td> New transformation models&#160;: Rigid 2D, Similarity 2D, Dense 2D. Support of extensive grandeurs (images which intensity have to raise when it is shrinked). Support of hyperimage with varying number of channels
</td>
<td> ...
</td></tr></table>
<h2><span class="mw-headline" id="Possible_issues_and_recommendations">Possible issues and recommendations</span></h2>
<ul><li> <b>Dealing with large datasets&#160;: </b> biological images are sometimes very large. In the field of time-lapse microscopy, <a href="BigStitcher" title="BigStitcher">BigStitcher</a> plugin handles such data, using BigDataViewer, as its registration algorithm, perfect for monomodal data of lightsheet microscopy, is well fitted to this task. </li></ul>
<p>Fijiyama is based on the Blockmatching registration algorithm, robust for inter-modality. This algorithm is memory consuming and computation intensive. When starting Fijiyama, the plugin analyzes your computer settings and might propose to subsample your dataset to fasten the registration process. This will not impact the appearance of the final results since the exportation procedure is performed using the initial images, at the chosen resolution.
</p>
<ul><li> <b>Translation in 3D under Windows&#160;: </b>under Windows, translation mode in the  <a rel="nofollow" class="external text" href="3D_Viewer">3D_Viewer</a>  using SHIFT+drag can be hazardous. To address this, we associated surnumerous controls to the numerical keypad. Using “4” and “6” keys, you can translate the selected volume along the X axis. Using “8” and “2” along the Y axis. Using “5” and “0”, along the Z axis. Rotations can be handled with “7” and “9” (X axis), “1” and “3” (Y axis), and characters “p” and “o” for the Z axis. </li>
<li> <b>3D view disappears&#160;: </b>depending on the sequence of translations / rotations applied to the scene, the 3D viewer of Fiji/ImageJ sometimes "freezes". To solve this problem, turn the objects to a 90 degrees’ angle, and the viewer should come back.</li>
<li> <b>Other issues&#160;? </b>please tell us&#160;! Try to "repeat" your bug from the beginning, identify the context producing the bug, then send an email to corresponding author, including&#160;:</li></ul>
<p>- a compressed copy of your output directory
- the copy of the content of the ImageJ log window (probably a hundred lines of sentences in red telling where Exceptions were encountered)
- Any useful commentary
- if possible, the content of the black log window
- if possible, a link to the dataset used
</p>
<h2><span class="mw-headline" id="The_maths_behind">The maths behind</span></h2>
<p>Registration of two images is achieved estimating a geometrical transformation that can be applied to an image (the "moving one"), to superimpose it with another image (the "reference" one).
</p>
<h3><span class="mw-headline" id="Transformations">Transformations</span></h3>
<p>Fijiyama handles the following transformation families&#160;: 
</p>
<ul><li> Rigid transformations (translation + rotation), estimated using <a rel="nofollow" class="external text" href="VIB-lib">VIB-lib</a></li>
<li> Similarities (rigid + isotropic homothetic factor) estimated using <a rel="nofollow" class="external text" href="VIB-lib">VIB-lib</a></li>
<li> Dense vector field (a generic representation of a non-linear transformation), estimated using Gaussian interpolation</li></ul>
<p>For more details about transformation, check the supplementary data of the official publication (see section "Cite this work" below)
</p>
<h3><span class="mw-headline" id="Optimizers">Optimizers</span></h3>
<p>Common categories of registration optimizers, associated with different registration strategies&#160;:
</p>
<ul><li> <b><a rel="nofollow" class="external text" href="https://itk.org/about/">ITK</a></b> (Yoo <i>et al.</i> 2002)<b> iconic algorithm</b>  optimizes iteratively a transformation. The optimization process is guided by the superposition improvement measured using a global similarity measure between the two 3D images. Choosing this measure, we assume a relationship between intensities of reference and moving images, and that this relationship is valid and identical in any point of the image. That weak assumption can lead to robustness issues when dealing with multi-modal registration.</li>
<li> <b>The Block-Matching algorithm</b> <a rel="nofollow" class="external text" href="https://link.springer.com/content/pdf/10.1007/978-3-540-40899-4_57.pdf">(Ourselin <i>et al.</i> 2000)</a> is a hybrid method, using a similarity measure to establish correspondences between subparts of images, then using these correspondences to compute a global transformation for the whole image. Assuming that the relationship between intensities of reference and moving images can be valid in a local neighborhood, blockmatching uses it to compare subparts of the 3D images to identify correspondences. This algorithm is the default one in Fijiyama.</li>
<li> Fijiyama does not have a "geometric" registration algorithm yet. Principle of such algorithms is to extract features from each image, and to establish correspondences between extracted features. Such approach can lead to faster but less robust algorithms as it is difficult to define a feature extraction method that is modality-independent, object-independent, and scale-independent. But for monomodal registration, such algorithms can provide great success, like <a href="BigStitcher" title="BigStitcher">BigStitcher</a> with microscopy images</li></ul>
<h2><span class="mw-headline" id="Limitations">Limitations</span></h2>
<p>For large datasets (15 and more timepoints) or images (1GB+), specific tools should be used. 
Here is a non-exhaustive list of plugins for <a href="ImageJ" title="ImageJ">ImageJ</a> / <a href="Fiji" title="Fiji">Fiji</a>, available for 3D registration of large datasets: <a href="BigStitcher" title="BigStitcher">BigStitcher</a>, <a href="Atlas_Toolkit" title="Atlas Toolkit">Atlas_Toolkit</a>, <a href="TrakEM2" title="TrakEM2">TrakEM2</a> or <a href="Elastix" title="Elastix">Elastix</a> wrapping plugin. 
Outside from the ImageJ world, for people who are not afraid to script, <a rel="nofollow" class="external text" href="http://elastix.isi.uu.nl/">Elastix</a> is a proper tool for series, and <a rel="nofollow" class="external text" href="https://www.slicer.org/">Slicer</a> can also do a great job. 
Limited to two-images registration, <a rel="nofollow" class="external text" href="https://med.inria.fr/">MedInria</a> is a very powerful and popular tool for medical images, which shares a lot of algorithmic basis with Fijiyama.
</p>
<h2><span class="mw-headline" id="Citing_this_work">Citing this work</span></h2>
<ul><li> R. Fernandez and C. Moisy, <i>“Fijiyama: a registration tool for 3D multimodal time-lapse imaging”</i> (under review)</li></ul>
<h2><span class="mw-headline" id="Contact">Contact</span></h2>
<p>Issues, feature request&#160;? Please contact romainfernandez06ATgmail.com
</p>
<h2><span class="mw-headline" id="References">References</span></h2>
<ul><li> Hörl, David, Fabio Rojas Rusak, Friedrich Preusser, Paul Tillberg, Nadine Randel, Raghav K. Chhetri, Albert Cardona, et al. 2019. «&#160;BigStitcher: Reconstructing High-Resolution Image Datasets of Cleared and Expanded Samples&#160;». Nature Methods 16 (9): 870-74. <a rel="nofollow" class="external free" href="https://doi.org/10.1038/s41592-019-0501-0">https://doi.org/10.1038/s41592-019-0501-0</a>.</li></ul>
<ul><li> Ourselin, S., A. Roche, S. Prima, et N. Ayache. 2000. «&#160;Block Matching: A General Framework to Improve Robustness of Rigid Registration of Medical Images&#160;». In Medical Image Computing and Computer-Assisted Intervention – MICCAI 2000, édité par Scott L. Delp, Anthony M. DiGoia, et Branislav Jaramaz, 1935:557-66. Berlin, Heidelberg: Springer Berlin Heidelberg. <a rel="nofollow" class="external free" href="https://doi.org/10.1007/978-3-540-40899-4_57">https://doi.org/10.1007/978-3-540-40899-4_57</a>.</li></ul>
<ul><li> Schindelin, Johannes, Ignacio Arganda-Carreras, Erwin Frise, Verena Kaynig, Mark Longair, Tobias Pietzsch, Stephan Preibisch, et al. 2012. «&#160;Fiji: An Open-Source Platform for Biological-Image Analysis&#160;». Nature Methods 9 (7): 676-82. <a rel="nofollow" class="external free" href="https://doi.org/10.1038/nmeth.2019">https://doi.org/10.1038/nmeth.2019</a>.</li></ul>
<ul><li> Yoo, Terry S., Michael J. Ackerman, William E. Lorensen, Will Schroeder, Vikram Chalana, Stephen Aylward, Dimitris Metaxas, et Ross Whitaker. 2002. «&#160;Engineering and Algorithm Design for an Image Processing Api: A Technical Report on ITK--the Insight Toolkit&#160;». Studies in Health Technology and Informatics 85: 586-92.</li></ul>
<h2><span class="mw-headline" id="Software_dependencies_acknowledgements">Software dependencies acknowledgements</span></h2>
<ul><li> Johannes Schindelin et al for <a rel="nofollow" class="external text" href="Fiji">Fiji</a> (Schindelin et al., 2012)</li>
<li> Johannes Schindelin et al. for the <a rel="nofollow" class="external text" href="VIB-lib">VIB-lib</a></li>
<li> Benjamin Schmid et al for the <a rel="nofollow" class="external text" href="3D_Viewer">3D Viewer</a> (Schmid et al., 2010)</li>
<li> The <a rel="nofollow" class="external text" href="https://itk.org/about/">ITK</a> and <a rel="nofollow" class="external text" href="http://www.simpleitk.org/">SimpleITK</a> teams (Yoo et al., 2002; Lowekamp et al., 2013)</li></ul>
<h2><span class="mw-headline" id="License">License</span></h2>
<p>This program is an open-source <b>free software</b>: it can be redistributed and/or modified under the terms of the <b>GNU General Public License</b> as published by the Free Software Foundation (<a rel="nofollow" class="external free" href="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</a>).
</p><p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.  
</p>
<hr />

<!-- 
NewPP limit report
Cached time: 20200713065132
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.044 seconds
Real time usage: 0.043 seconds
Preprocessor visited node count: 221/1000000
Preprocessor generated node count: 1083/1000000
Post‐expand include size: 1199/2097152 bytes
Template argument size: 431/2097152 bytes
Highest expansion depth: 10/40
Expensive parser function count: 0/3
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    4.576      1 - -total
100.00%    4.576      1 - Template:Infobox
 31.38%    1.436      1 - Template:GitHub
-->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="index.php?title=Fijiyama&amp;oldid=45644">http://imagej.net/index.php?title=Fijiyama&amp;oldid=45644</a>"</div>
							</div>

			<div id="footer">
				<p> This page was last modified on 10 June 2020, at 16:21.</p><ul><li><a href="./ImageJ:Privacy_policy" title="ImageJ:Privacy policy">Privacy policy</a></li><li><a href="./ImageJ:About" class="mw-redirect" title="ImageJ:About">About ImageJ</a></li><li><a href="Imprint" title="Imprint">Imprint</a></li></ul>			</div>

			<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="./Special:Categories" title="Special:Categories">Categories</a>: <ul><li><a href="./Category:Plugins" title="Category:Plugins">Plugins</a></li><li><a href="./Category:Registration" title="Category:Registration">Registration</a></li><li><a href="./Category:Citable" title="Category:Citable">Citable</a></li></ul></div></div>		</div>

		<div id="bottom-wrap">
			<div id="footer-wrap-inner">
				<div id="ternary" class="footer">
					<ul>
						<li class="widget">
							<img id="logo" src="skins/imagej-128.png" alt="">
						</li>
					</ul>
				</div>
			</div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.loader.load(["ext.fancytree","ext.suckerfish","mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","ext.SimpleTooltip"]);});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":235});});</script>
		</body>
		</html>
		