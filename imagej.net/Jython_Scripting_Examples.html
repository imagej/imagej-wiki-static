<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>Jython Scripting Examples - ImageJ</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Jython_Scripting_Examples","wgTitle":"Jython Scripting Examples","wgCurRevisionId":41272,"wgRevisionId":41272,"wgArticleId":4014,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Scripting","Jython"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Jython_Scripting_Examples","wgRelevantArticleId":4014,"wgRequestId":"18ab8df7120f31456c700347","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgPreferredVariant":"en","fancytree_path":"/extensions/TreeAndMenu/fancytree"});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user.cssprefs":"ready","user":"ready","user.options":"loading","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","skins.erudite":"ready"});mw.loader.implement("user.options@0j3lz3q",function($,jQuery,require,module){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens@1ku9xth",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["mediawiki.page.startup"]);});</script>
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%252Cshared%257Cmediawiki.sectionAnchor%257Cskins.erudite&amp;only=styles&amp;skin=erudite.css"/>
<script async="" src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=erudite"></script>
<link rel="stylesheet" href="extensions/TreeAndMenu/fancytree/fancytree.css"/><link rel="stylesheet" href="extensions/TreeAndMenu/suckerfish/suckerfish.css"/>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=erudite.css"/>
<meta name="generator" content="MediaWiki 1.28.0"/>
<meta name="description" content="Jython is an implementation of the Python programming language designed to run on the Java platform."/>
<link rel="shortcut icon" href="skins/ij2.ico"/>

<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shCore.js"></script>
<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shBrushPython.js"></script>
<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shBrushJava.js"></script>
<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shBrushPlain.js"></script>
<script type="text/javascript">
SyntaxHighlighter.all();
</script>
<link rel="stylesheet" type="text/css" media="screen" href="extensions/SyntaxHighlighter/syntaxhighlighter/styles/shCoreMinit.css" />

	<meta property="og:type" content="article"/>

	<meta property="og:site_name" content="ImageJ"/>

	<meta property="og:title" content="Jython Scripting Examples"/>

	<meta property="og:description" content="Jython is an implementation of the Python programming language designed to run on the Java platform."/>


<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Jython_Scripting_Examples rootpage-Jython_Scripting_Examples skin-erudite action-view">
		<div class="mw-jump">
			<a href="Jython_Scripting_Examples.html#bodyContent">Skip to content</a>, 			<a href="Jython_Scripting_Examples.html#search">Skip to search</a>
		</div>

		<div id="top-wrap" role="banner">
			<h1><a href="Welcome" title="ImageJ" rel="home">ImageJ</a></h1>
			<div id="tagline">From ImageJ</div>

			<a id="menubutton" href="Jython_Scripting_Examples.html#menu">Menu</a>
			<div id="nav" role="navigation">
			<ul id='menu'>
<li id="menu-item-n-About"><a href="ImageJ">About</a></li>
<li id="menu-item-n-Downloads"><a href="Downloads">Downloads</a></li>
<li id="menu-item-n-Learn"><a href="Learn">Learn</a></li>
<li id="menu-item-n-Develop"><a href="Development">Develop</a></li>
<li id="menu-item-n-News"><a href="News">News</a></li>
<li id="menu-item-n-Events"><a href="Events">Events</a></li>
<li id="menu-item-n-Help"><a href="Help">Help</a></li>
</ul>
			</div>
		</div>

		<div id="mw-js-message"></div>
		
		<div id="main" role="main">
			<div id="nav-meta">
			<span id="ca-nstab-main" class="selected"><a href="Jython_Scripting_Examples" title="View the content page [c]" accesskey="c">Page</a></span><span class="meta-sep">|</span><span id="ca-talk" class="new"><a href="index.php?title=Talk:Jython_Scripting_Examples&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></span><span class="meta-sep">|</span><span id="ca-viewsource"><a href="index.php?title=Jython_Scripting_Examples&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span><span class="meta-sep">|</span><span id="ca-history"><a href="index.php?title=Jython_Scripting_Examples&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></span><span class="meta-sep">|</span>			</div>

			<div id="bodyContent">
				<h1>Jython Scripting Examples</h1>
				
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div style="overflow:hidden"><table class="metadata plainlinks ambox ambox-notice">
<tr>
<td class="ambox-image">
<p><a href="./File:Information-sign.png" class="image"><img alt="Information-sign.png" src="_images/2/24/Information-sign.png" width="40" height="40" /></a>
</p>
</td>
<td> This page is a copy of <a href="Jython_Scripting" title="Jython Scripting">Jython Scripting</a>. The original wiki page is in a rewrite progress. When rewriting <a href="Jython_Scripting" title="Jython Scripting">Jython Scripting</a> is finished, this wiki page will be shortened to only contain Jython code examples. </td>
<p><br />
</p>
</tr>
</table></div>
<p><br />
</p>
<table class="infobox" cellspacing="5" style="text-align: left; float: right; border: 1px solid #a0a0a0; font-size: 80%;">
<tr>
<th colspan="2" style="font-size: 130%;">  Learn
</th></tr>
<tr>
<td>
</td></tr>
<tr>
<td>
<table class="infobox mw-collapsible mw-collapsed" cellspacing="5" data-collapsetext="-" data-expandtext="+" style="width: 100%; text-align: left; border-top: 1px solid #336699; border-right: none; border-left: none; border-bottom: none;">
<tr>
<th>  Topics
</th></tr>


<tr>
<td>  <a href="Introduction" title="Introduction">Introduction</a>
</td></tr>
<tr>
<td>  <a href="Getting_Started" title="Getting Started">Getting Started</a>
</td></tr>
<tr>
<td>  <a href="User_Guides" title="User Guides">User Guides</a>
</td></tr>
<tr>
<td>  <a href="./Category:Tutorials" title="Category:Tutorials">Tutorials</a>
</td></tr>
<tr>
<td>  <a href="Tips_and_Tricks" title="Tips and Tricks">Tips and Tricks</a>
</td></tr>
<tr>
<td>  <a href="Presentations" title="Presentations">Presentations</a>
</td></tr>
<tr>
<td>  <a href="Plugins" title="Plugins">Plugins</a>
</td></tr></table>
</td></tr>
<tr>
<td>
<table class="infobox mw-collapsible mw-collapsed" cellspacing="5" data-collapsetext="-" data-expandtext="+" style="width: 100%; text-align: left; border-top: 1px solid #336699; border-right: none; border-left: none; border-bottom: none;">
<tr>
<th>  Techniques
</th></tr>


<tr>
<td>  <a href="./Category:Techniques" title="Category:Techniques">All Techniques</a>
</td></tr>
<tr>
<td>  <a href="Colocalization_Analysis" title="Colocalization Analysis"> Colocalization</a>
</td></tr>
<tr>
<td>  <a href="Deconvolution" title="Deconvolution">Deconvolution</a>
</td></tr>
<tr>
<td>  <a href="Registration" title="Registration">Registration</a>
</td></tr>
<tr>
<td>  <a href="Segmentation" title="Segmentation">Segmentation</a>
</td></tr>
<tr>
<td>  <a href="Image_Stitching" title="Image Stitching"> Stitching</a>
</td></tr>
<tr>
<td>  <a href="Tracking" title="Tracking">Tracking</a>
</td></tr>
<tr>
<td>  <a href="Visualization" title="Visualization">Visualization</a>
</td></tr></table>
</td></tr>
<tr>
<td>
<table class="infobox mw-collapsible" cellspacing="5" data-collapsetext="-" data-expandtext="+" style="width: 100%; text-align: left; border-top: 1px solid #336699; border-right: none; border-left: none; border-bottom: none;">
<tr>
<th>  Scripting
</th></tr>


<tr>
<td>  <a href="Scripting" title="Scripting">Overview</a>
</td></tr>
<tr>
<td>  <a href="User_input" title="User input">User input</a>
</td></tr>
<tr>
<td>  <a href="Scripting_basics" title="Scripting basics">Basics of script writing</a>
</td></tr>
<tr>
<td>  <a href="How_to_use_the_Javadoc" title="How to use the Javadoc">How to use the Javadoc</a>
</td></tr>
<tr>
<td>  <a href="Batch_Processing" title="Batch Processing">Batch processing</a>
</td></tr>
<tr>
<td>  <a href="Using_the_Script_Editor" title="Using the Script Editor">Script Editor</a>
</td></tr>
<tr>
<td>  <a href="Script_Editor_Auto_Import" title="Script Editor Auto Import">Auto Imports</a>
</td></tr>
<tr>
<td>  <a href="Script_Templates" title="Script Templates">Templates</a>
</td></tr>
<tr>
<td>  <a href="Scripting_Headless" title="Scripting Headless">Running headlessly</a>
</td></tr>
<tr>
<td>  <a href="Scripting_comparisons" title="Scripting comparisons">Comparisons</a>
</td></tr>
<tr>
<td>  <a href="Scripting_toolbox" title="Scripting toolbox">Toolbox</a>
</td></tr>
<tr>
<td>  <a href="Multithreaded_Image_Processing_in_Clojure" title="Multithreaded Image Processing in Clojure">Multithreading in Clojure</a>
</td></tr>
<tr>
<td>  <a href="Multithreaded_Image_Processing_in_JavaScript" title="Multithreaded Image Processing in JavaScript">Multithreading in JavaScript</a>
</td></tr>
<tr>
<td>  <a href="Chess" title="Chess">Chess</a> in Jython
</td></tr></table>
</td></tr>
<tr>
<td>
<table class="infobox mw-collapsible mw-collapsed" cellspacing="5" data-collapsetext="-" data-expandtext="+" style="width: 100%; text-align: left; border-top: 1px solid #336699; border-right: none; border-left: none; border-bottom: none;">
<tr>
<th>  Languages
</th></tr>


<tr>
<td>  <a href="BeanShell_Scripting" title="BeanShell Scripting">BeanShell</a>
</td></tr>
<tr>
<td>  <a href="Groovy_Scripting" title="Groovy Scripting">Groovy</a>
</td></tr>
<tr>
<td>  <a href="Introduction_into_Macro_Programming" title="Introduction into Macro Programming">ImageJ Macro</a>
</td></tr>
<tr>
<td>  <a href="JavaScript_Scripting" title="JavaScript Scripting">JavaScript</a>
</td></tr>
<tr>
<td>  <a href="Clojure_Scripting" title="Clojure Scripting">Lisp (Clojure)</a>
</td></tr>
<tr>
<td>  <a href="MATLAB_Scripting" title="MATLAB Scripting">MATLAB</a>
</td></tr>
<tr>
<td>  <a href="Jython_Scripting" title="Jython Scripting">Python (Jython)</a>
</td></tr>
<tr>
<td>  <a href="Renjin_Scripting" title="Renjin Scripting">R (Renjin)</a>
</td></tr>
<tr>
<td>  <a href="JRuby_Scripting" title="JRuby Scripting">Ruby (JRuby)</a>
</td></tr>
<tr>
<td>  <a href="Scala_Scripting" title="Scala Scripting">Scala</a>
</td></tr></table>
</td></tr></table>
<p><a rel="nofollow" class="external text" href="http://www.jython.org/">Jython</a> is an implementation of the <a rel="nofollow" class="external text" href="https://www.python.org/">Python programming language</a> designed to run on the Java platform.
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Jython_Scripting_Examples.html#Quickstart"><span class="tocnumber">1</span> <span class="toctext">Quickstart</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="Jython_Scripting_Examples.html#The_Jython_interpreter_plugin"><span class="tocnumber">2</span> <span class="toctext">The Jython interpreter plugin</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="Jython_Scripting_Examples.html#Language_basics"><span class="tocnumber">2.1</span> <span class="toctext">Language basics</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="Jython_Scripting_Examples.html#Importing_classes"><span class="tocnumber">2.1.1</span> <span class="toctext">Importing classes</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-5"><a href="Jython_Scripting_Examples.html#Workflow_for_creating_Jython_scripts"><span class="tocnumber">2.2</span> <span class="toctext">Workflow for creating Jython scripts</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="Jython_Scripting_Examples.html#Some_limitations_of_jython"><span class="tocnumber">2.3</span> <span class="toctext">Some limitations of jython</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="Jython_Scripting_Examples.html#Jython_tutorials_for_ImageJ"><span class="tocnumber">3</span> <span class="toctext">Jython tutorials for ImageJ</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="./Jython_Scripting_Examples.html#Defining_variables:_obtaining_the_current_image"><span class="tocnumber">3.1</span> <span class="toctext">Defining variables: obtaining the current image</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="Jython_Scripting_Examples.html#Manipulating_pixels"><span class="tocnumber">3.2</span> <span class="toctext">Manipulating pixels</span></a>
<ul>
<li class="toclevel-3 tocsection-10"><a href="Jython_Scripting_Examples.html#Creating_a_grayscale_ramp_image"><span class="tocnumber">3.2.1</span> <span class="toctext">Creating a grayscale ramp image</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="Jython_Scripting_Examples.html#Creating_a_random_8-bit_image"><span class="tocnumber">3.2.2</span> <span class="toctext">Creating a random 8-bit image</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="Jython_Scripting_Examples.html#Creating_a_random_image.2C_the_easy_way"><span class="tocnumber">3.2.3</span> <span class="toctext">Creating a random image, the easy way</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-13"><a href="Jython_Scripting_Examples.html#Running_a_watershed_plugin_on_an_image"><span class="tocnumber">3.3</span> <span class="toctext">Running a watershed plugin on an image</span></a>
<ul>
<li class="toclevel-3 tocsection-14"><a href="Jython_Scripting_Examples.html#..._and_counting_particles.2C_and_measuring_their_areas"><span class="tocnumber">3.3.1</span> <span class="toctext">... and counting particles, and measuring their areas</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-15"><a href="Jython_Scripting_Examples.html#Creating_an_image_from_a_text_file"><span class="tocnumber">3.4</span> <span class="toctext">Creating an image from a text file</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="Jython_Scripting_Examples.html#Obtain.2FView_histogram_and_measurements_from_an_image"><span class="tocnumber">3.5</span> <span class="toctext">Obtain/View histogram and measurements from an image</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="Jython_Scripting_Examples.html#Removing_bleeding_from_one_channel_to_another"><span class="tocnumber">3.6</span> <span class="toctext">Removing bleeding from one channel to another</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="Jython_Scripting_Examples.html#Subtract_the_minimal_value_to_an_image"><span class="tocnumber">3.7</span> <span class="toctext">Subtract the minimal value to an image</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="Jython_Scripting_Examples.html#Extract_a_specific_color_channel_for_a_given_time_frame_of_a_composite_image"><span class="tocnumber">3.8</span> <span class="toctext">Extract a specific color channel for a given time frame of a composite image</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="Jython_Scripting_Examples.html#Visualize_any_number_of_TIFF_stacks_in_a_single_composite_multi-color_image_stack"><span class="tocnumber">3.9</span> <span class="toctext">Visualize any number of TIFF stacks in a single composite multi-color image stack</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="Jython_Scripting_Examples.html#Sort_all_points_of_a_PointRoi_into_a_chain_by_distance_to_each_other"><span class="tocnumber">3.10</span> <span class="toctext">Sort all points of a PointRoi into a chain by distance to each other</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="./Jython_Scripting_Examples.html#Correct_illumination_in_a_stack:_apply_the_illumination_of_one_slice_to_all_others"><span class="tocnumber">3.11</span> <span class="toctext">Correct illumination in a stack: apply the illumination of one slice to all others</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="Jython_Scripting_Examples.html#Add_a_mouse_listener_to_the_canvas_of_every_open_image"><span class="tocnumber">3.12</span> <span class="toctext">Add a mouse listener to the canvas of every open image</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="Jython_Scripting_Examples.html#Add_a_key_listener_to_the_canvas_of_every_open_image"><span class="tocnumber">3.13</span> <span class="toctext">Add a key listener to the canvas of every open image</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="Jython_Scripting_Examples.html#Create_a_virtual_stack_from_the_TIF_files_present_in_a_folder_and_its_subfolders.2C_recursively"><span class="tocnumber">3.14</span> <span class="toctext">Create a virtual stack from the TIF files present in a folder and its subfolders, recursively</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="Jython_Scripting_Examples.html#Open_the_slices_of_a_very_large_multi-image_stack_file_one_by_one.2C_and_save_each_as_a_new_image_file"><span class="tocnumber">3.15</span> <span class="toctext">Open the slices of a very large multi-image stack file one by one, and save each as a new image file</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="Jython_Scripting_Examples.html#Apply_a_binary_mask_to_every_slice_in_an_image_stack"><span class="tocnumber">3.16</span> <span class="toctext">Apply a binary mask to every slice in an image stack</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="Jython_Scripting_Examples.html#Open_all_series_in_a_LIF_file_with_Bio-Formats"><span class="tocnumber">3.17</span> <span class="toctext">Open all series in a LIF file with Bio-Formats</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="Jython_Scripting_Examples.html#Open_and_save_movies_with_the_FFMPEG_I.2FO_plugin"><span class="tocnumber">3.18</span> <span class="toctext">Open and save movies with the FFMPEG I/O plugin</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="Jython_Scripting_Examples.html#Skeletonize_an_image_and_analyze_the_skeleton"><span class="tocnumber">3.19</span> <span class="toctext">Skeletonize an image and analyze the skeleton</span></a></li>
<li class="toclevel-2 tocsection-31"><a href="Jython_Scripting_Examples.html#Find_peaks_in_a_3D_image"><span class="tocnumber">3.20</span> <span class="toctext">Find peaks in a 3D image</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-32"><a href="Jython_Scripting_Examples.html#Tips_and_Tricks"><span class="tocnumber">4</span> <span class="toctext">Tips and Tricks</span></a>
<ul>
<li class="toclevel-2 tocsection-33"><a href="Jython_Scripting_Examples.html#Getting_a_list_of_all_members_in_one_package"><span class="tocnumber">4.1</span> <span class="toctext">Getting a list of all members in one package</span></a></li>
<li class="toclevel-2 tocsection-34"><a href="Jython_Scripting_Examples.html#Specifying_the_encoding_of_the_source"><span class="tocnumber">4.2</span> <span class="toctext">Specifying the encoding of the source</span></a></li>
<li class="toclevel-2 tocsection-35"><a href="Jython_Scripting_Examples.html#Changing_the_default_encoding"><span class="tocnumber">4.3</span> <span class="toctext">Changing the default encoding</span></a></li>
<li class="toclevel-2 tocsection-36"><a href="Jython_Scripting_Examples.html#Error_handling_with_try_.2F_except_.2F_finally"><span class="tocnumber">4.4</span> <span class="toctext">Error handling with try / except / finally</span></a></li>
<li class="toclevel-2 tocsection-37"><a href="Jython_Scripting_Examples.html#Importing_other_.py_scripts_.28modules.29"><span class="tocnumber">4.5</span> <span class="toctext">Importing other <i>.py</i> scripts (modules)</span></a></li>
<li class="toclevel-2 tocsection-38"><a href="Jython_Scripting_Examples.html#Defining_a_class_and_creating_instances_of_the_new_class"><span class="tocnumber">4.6</span> <span class="toctext">Defining a class and creating instances of the new class</span></a></li>
<li class="toclevel-2 tocsection-39"><a href="Jython_Scripting_Examples.html#Adding_a_static_method_to_a_class"><span class="tocnumber">4.7</span> <span class="toctext">Adding a static method to a class</span></a></li>
<li class="toclevel-2 tocsection-40"><a href="Jython_Scripting_Examples.html#Creating_multi-dimensional_native_java_arrays"><span class="tocnumber">4.8</span> <span class="toctext">Creating multi-dimensional native java arrays</span></a></li>
<li class="toclevel-2 tocsection-41"><a href="./Jython_Scripting_Examples.html#Inline_java_code_inside_jython:_the_Weaver"><span class="tocnumber">4.9</span> <span class="toctext">Inline java code inside jython: the Weaver</span></a></li>
<li class="toclevel-2 tocsection-42"><a href="Jython_Scripting_Examples.html#Reading_command_line_arguments_given_to_a_script"><span class="tocnumber">4.10</span> <span class="toctext">Reading command line arguments given to a script</span></a></li>
<li class="toclevel-2 tocsection-43"><a href="Jython_Scripting_Examples.html#Catching_errors_from_a_running_macro"><span class="tocnumber">4.11</span> <span class="toctext">Catching errors from a running macro</span></a></li>
<li class="toclevel-2 tocsection-44"><a href="Jython_Scripting_Examples.html#Running_3rd_party_java_libraries"><span class="tocnumber">4.12</span> <span class="toctext">Running 3rd party java libraries</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-45"><a href="Jython_Scripting_Examples.html#Jython_for_plugins"><span class="tocnumber">5</span> <span class="toctext">Jython for plugins</span></a>
<ul>
<li class="toclevel-2 tocsection-46"><a href="Jython_Scripting_Examples.html#Using_a_jython_script_as_a_plugin"><span class="tocnumber">5.1</span> <span class="toctext">Using a jython script as a plugin</span></a></li>
<li class="toclevel-2 tocsection-47"><a href="Jython_Scripting_Examples.html#Distributing_jython_scripts_in_a_.jar_file"><span class="tocnumber">5.2</span> <span class="toctext">Distributing jython scripts in a .jar file</span></a>
<ul>
<li class="toclevel-3 tocsection-48"><a href="Jython_Scripting_Examples.html#Manual_packaging"><span class="tocnumber">5.2.1</span> <span class="toctext">Manual packaging</span></a></li>
<li class="toclevel-3 tocsection-49"><a href="Jython_Scripting_Examples.html#With_Maven"><span class="tocnumber">5.2.2</span> <span class="toctext">With Maven</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-50"><a href="Jython_Scripting_Examples.html#Jython_examples_in_Fiji"><span class="tocnumber">6</span> <span class="toctext">Jython examples in Fiji</span></a></li>
<li class="toclevel-1 tocsection-51"><a href="Jython_Scripting_Examples.html#See_also"><span class="tocnumber">7</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Quickstart">Quickstart</span></h2>
<ul><li> Press <kbd class="keyboard-key nowrap" style="border: 1px solid #aaa; -moz-border-radius: 0.2em; -webkit-border-radius: 0.2em; border-radius: 0.2em; -moz-box-shadow: 0.1em 0.2em 0.2em #ddd; -webkit-box-shadow: 0.1em 0.2em 0.2em #ddd; box-shadow: 0.1em 0.2em 0.2em #ddd; background-color: #f9f9f9; background-image: -moz-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -o-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -webkit-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: linear-gradient(&#91;&#91;:Template:Linear-gradient/legacy]], #eee, #f9f9f9, #eee); padding: 0.1em 0.3em; font-family: inherit; font-size: 0.85em;">[</kbd> to bring up the <a href="Script_Editor" class="mw-redirect" title="Script Editor">Script Editor</a>.</li>
<li> Select an example Jython script from the <span><em><span style="border-bottom:1px dotted #ccc;"> Templates </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> [by language] </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> Python</span></em></span> menu.</li>
<li> Press <kbd class="keyboard-key nowrap" style="border: 1px solid #aaa; -moz-border-radius: 0.2em; -webkit-border-radius: 0.2em; border-radius: 0.2em; -moz-box-shadow: 0.1em 0.2em 0.2em #ddd; -webkit-box-shadow: 0.1em 0.2em 0.2em #ddd; box-shadow: 0.1em 0.2em 0.2em #ddd; background-color: #f9f9f9; background-image: -moz-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -o-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -webkit-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: linear-gradient(&#91;&#91;:Template:Linear-gradient/legacy]], #eee, #f9f9f9, #eee); padding: 0.1em 0.3em; font-family: inherit; font-size: 0.85em;"><span class="Unicode">^</span> Ctrl</kbd>+<kbd class="keyboard-key nowrap" style="border: 1px solid #aaa; -moz-border-radius: 0.2em; -webkit-border-radius: 0.2em; border-radius: 0.2em; -moz-box-shadow: 0.1em 0.2em 0.2em #ddd; -webkit-box-shadow: 0.1em 0.2em 0.2em #ddd; box-shadow: 0.1em 0.2em 0.2em #ddd; background-color: #f9f9f9; background-image: -moz-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -o-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -webkit-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: linear-gradient(&#91;&#91;:Template:Linear-gradient/legacy]], #eee, #f9f9f9, #eee); padding: 0.1em 0.3em; font-family: inherit; font-size: 0.85em;">R</kbd> to run the script!</li></ul>
<h2><span class="mw-headline" id="The_Jython_interpreter_plugin">The Jython interpreter plugin</span></h2>
<p>The interpreter provides a screen and a prompt. Type any jython code on the prompt to interact with ImageJ.
</p><p>Launch it from <span><em><span style="border-bottom:1px dotted #ccc;"> Plugins </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> Scripting </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> Jython Interpreter</span></em></span>. See <a href="Scripting_Help" class="mw-redirect" title="Scripting Help">Scripting Help</a> for all keybindings, and also <a href="Scripting_comparisons" title="Scripting comparisons">Scripting comparisons</a>.
</p>
<div style="overflow:hidden"><table class="metadata plainlinks ambox ambox-content">
<tr>
<td class="ambox-image">
<p><a href="./File:Important-sign.png" class="image"><img alt="Important-sign.png" src="_images/f/f0/Important-sign.png" width="40" height="40" /></a>
</p>
</td>
<td> Note that ImageJ also ships a unified Script Interpreter plugin, accessible from <span><em><span style="border-bottom:1px dotted #ccc;"> Plugins </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> Scripting </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> Script Interpreter</span></em></span>. But it is currently beta quality, and the Python language does not work properly due to bugs. Once this issue is fixed, the unified Script Interpreter will replace the language-specific interpreters such as the Jython Interpreter. </td>
<p><br />
</p>
</tr>
</table></div>
<p><br />
Within the interpreter, all ImageJ, java.lang.* and TrakEM2 classes are automatically imported. So creating new images and manipulating them is very straighforward.
</p><p><br />
</p>
<h3><span class="mw-headline" id="Language_basics">Language basics</span></h3>
<ul><li> Any text after a # is commented out.</li>
<li> There are no line terminators (such as ';' in other languages), neither curly braces to define code blocks.</li>
<li> Indentation defines code blocks.</li>
<li> Functions are defined with <i>def</i>, and classes with <i>class</i>.</li>
<li> Functions are objects, and thus storable in variables.</li>
<li> Jython (and python in general) accepts a mixture of procedural and object-oriented code.</li>
<li> Jython currently implements the Python language at its 2.5 version. All <a rel="nofollow" class="external text" href="http://www.python.org/doc/2.5.2/">documentation for python 2.5</a> applies to Jython bundled with Fiji (with the remarks listed later).</li></ul>
<h4><span class="mw-headline" id="Importing_classes">Importing classes</span></h4>
<p>To reference Java classes from Jython you will need to import them.
</p>
<div style="overflow:hidden"><table class="metadata plainlinks ambox ambox-content">
<tr>
<td class="ambox-image">
<p><a href="./File:Important-sign.png" class="image"><img alt="Important-sign.png" src="_images/f/f0/Important-sign.png" width="40" height="40" /></a>
</p>
</td>
<td> Unlike <a href="ImageJ_1.x" class="mw-redirect" title="ImageJ 1.x">ImageJ 1.x</a>, <a href="ImageJ2" title="ImageJ2">ImageJ2</a> (and therefore <a href="Fiji" title="Fiji">Fiji</a>) does not automatically import any classes. Consequently, scripts written for <a href="ImageJ_1.x" class="mw-redirect" title="ImageJ 1.x">ImageJ 1.x</a> will not run in <a href="ImageJ2" title="ImageJ2">ImageJ2</a> without adding the proper imports.
The rationale is that the auto-import feature is not safe. What if two classes of the same name live in two different packages? Or if a new class is introduced that makes formerly unique names ambiguous? All of a sudden, all of the scripts that reference the original class no longer work. In short: auto-imports are dangerously imprecise. </td>


</tr>
</table></div>
<p><br />
You can specify imports in Jython as follows:
</p>
<pre class="brush:python">
from java.io import File
</pre>
<p>Where <code>java.io.File</code> is the class to be imported. See also section <a href="Jython_Scripting_Examples.html#Importing_other_.py_scripts_.28modules.29">Importing other <i>.py</i> scripts (modules)</a> for importing user python modules.
</p>
<h3><span class="mw-headline" id="Workflow_for_creating_Jython_scripts">Workflow for creating Jython scripts</span></h3>
<p>To create a script for the GUI, the recommended setup is the following:
</p>
<ul><li> Edit and save a file in your favorite text editor. If you want ImageJ1 to insert it into the Menu structure, the file must be saved somewhere under ImageJ plugins folder, have an underscore on the name, and a .py extension.</li>
<li> Run <span><em><span style="border-bottom:1px dotted #ccc;"> Plugins </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> Scripting </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> Refresh Jython scripts</span></em></span> <b>only</b> the very first time after newly creating the file under any folder or subfolder of ImageJ's plugins folder. A menu item will appear with its name, from which it can be run.</li>
<li> Keep editing (and saving) the file from your editor. Just select the menu item to execute it over and over. Or use the <span><em><span style="border-bottom:1px dotted #ccc;"> Plugins </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> Utilities </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> Find Commands...</span></em></span> window to launch it easily (keybinding 'l').</li></ul>
<p>The next time Fiji is run, it will setup all your scripts in the Plugins menu.
</p><p>If all you need is a script to run in headless mode, simply do:
</p>
<pre> fiji --headless filepath.py
</pre>
<h3><span class="mw-headline" id="Some_limitations_of_jython">Some limitations of jython</span></h3>
<div style="float:right; width: 300px; border: 1px solid #ccc; padding: 15px !important; margin-top: 1em; margin-bottom: 2em; background-color: #ffefbe; -moz-border-radius: .75em; -webkit-border-radius: .75em; border-radius: .75em;-moz-box-shadow: 4px 4px 4px #CCC; -webkit-box-shadow: 4px 4px 4px #CCC; box-shadow: 4px 4px 4px #CCC;">
<p style="font-size: large; font-weight: bold; margin-top: 0; padding-top: 0">What about NumPy and SciPy?</p>  If you like Python, you probably want to use Python modules such as the excellent <a rel="nofollow" class="external text" href="http://www.numpy.org/">NumPy</a> and <a rel="nofollow" class="external text" href="http://www.scipy.org/">SciPy</a> libraries. Unfortunately, Jython does not support linking to Python modules backed by native code. See <a rel="nofollow" class="external text" href="http://forum.imagej.net/t/python-scripting/80">this thread on the ImageJ forum</a> for some options and alternatives. This area is somewhere a dedicated programmer could make a huge splash and benefit the entire scientific community.
</div>
<p>Though jython tries to be as close as possible as python, there are some differences you may experience during scripting.
</p>
<ul><li> <u>Float "special numbers" such as <i>NaN</i> and <i>Inf</i> are not handled.</u></li></ul>
<p>For instance, 
</p>
<pre class="brush:python"> a = float('nan') </pre>
<p>will create the correct float number in python, but will throw an exception in jython.
</p><p>Instead, to create a NaN in jython, use:
</p>
<pre class="brush:python">
&gt;&gt;&gt; a = Double.NaN
&gt;&gt;&gt; print a
NaN 
</pre>
<p>To test if a number is NaN:
</p>
<pre class="brush:python">
&gt;&gt;&gt; if Double.isNaN(a):
        print "a is NaN!"
a is NaN! 
</pre>
<ul><li> <u>Some existing python modules can't be imported in jython.</u></li></ul>
<dl><dd><dl><dd> This is for instance the case of the module <i>numpy</i>, which would have been really convenient for analysing data and results.</dd>
<dd></dd>
<dd> But see these java numerical libraries: <a rel="nofollow" class="external free" href="http://math.nist.gov/javanumerics/#libraries">http://math.nist.gov/javanumerics/#libraries</a> , of which:</dd></dl></dd></dl>
<dl><dd><ul><li> JaMa (Java Matrix Package)</li>
<li> Java3D (particularly its <a rel="nofollow" class="external text" href="http://java.sun.com/products/java-media/3D/forDevelopers/j3dapi/javax/vecmath/package-summary.html">vecmath</a> package provides general matrix and vector classes (<a rel="nofollow" class="external text" href="http://java.sun.com/products/java-media/3D/forDevelopers/j3dapi/javax/vecmath/GMatrix.html">GMatrix</a>, <a rel="nofollow" class="external text" href="http://java.sun.com/products/java-media/3D/forDevelopers/j3dapi/javax/vecmath/GVector.html">GVector</a>).</li></ul>
<dl><dd></dd>
<dd> ... are already included in Fiji.</dd></dl></dd></dl>
<ul><li> <u>Your Jython version may be matching a much older Python version than you expect.</u></li></ul>
<dl><dd><dl><dd> The latest Jython stable release (as of May 2015) is 2.7.0. Fiji (as of December 2015) distributes Jython 2.5.3. Any recent Python syntax such as <tt>except ExceptionType as e:</tt> or <tt>with open(filepath, 'r') as f:</tt> will fail.</dd></dl></dd></dl>
<h2><span class="mw-headline" id="Jython_tutorials_for_ImageJ">Jython tutorials for ImageJ</span></h2>
<h3><span class="mw-headline" id="Defining_variables:_obtaining_the_current_image">Defining variables: obtaining the current image</span></h3>
<pre class="brush:python">
imp = IJ.getImage()
</pre>
<p>Which is the same as:
</p>
<pre class="brush:python">
imp = WindowManager.getCurrentImage()
</pre>
<p>Since calling the above is long and tedious, one can declare a variable that points to the above static methods:
</p>
<pre class="brush:python">
c = WindowManager.getCurrentImage
</pre>
<p>Above note the lack of parentheses.
</p><p>To execute the function, just use parentheses on it:
</p>
<pre class="brush:python">
 imp = c()
</pre>
<p>The above gets the value of <i>c</i>, which is the method named getCurrentImage in class WindowManager, and executes it, storing its returned object in <i>imp</i>.
</p><p><br />
</p>
<h3><span class="mw-headline" id="Manipulating_pixels">Manipulating pixels</span></h3>
<h4><span class="mw-headline" id="Creating_a_grayscale_ramp_image">Creating a grayscale ramp image</span></h4>
<p>First create an image and obtain its pixels:
</p>
<pre class="brush:python">
imp = ImagePlus("my new image", FloatProcessor(512, 512))
pix = imp.getProcessor().getPixels()
</pre>
<p>The length of an array:
</p>
<pre class="brush:python">
n_pixels = len(pix)
</pre>
<p>Then loop to modify them:
</p>
<pre class="brush:python">
# catch width
w = imp.getWidth()
 
# create a ramp gradient from left to right
for i in range(len(pix)):
   pix[i] = i&#160;% w
 
# adjust min and max, since we know them
imp.getProcessor().setMinAndMax(0, w-1)
</pre>
<p>... and show the new image:
</p>
<pre class="brush:python">
imp.show()
</pre>
<p><br />
</p>
<h4><span class="mw-headline" id="Creating_a_random_8-bit_image">Creating a random 8-bit image</span></h4>
<p>First import necessary packages: Random, from standard java util library, and <a rel="nofollow" class="external text" href="http://www.jython.org/archive/21/docs/jarray.html">jarray</a>, the Jython module for native java arrays:
</p>
<pre class="brush:python">
from java.util import Random
from jarray import zeros
</pre>
<p>Then create the array and fill it with random bytes:
</p>
<pre class="brush:python">
width = 512
height = 512
 
pix = zeros(width * height, 'b')
Random().nextBytes(pix)
</pre>
<p>('z' = boolean, 'c' = char, 'b' = byte, 'h' = short, 'i' = int, 'l' = long, 'f' = float and 'd' = double, as explained in the <a rel="nofollow" class="external text" href="http://www.jython.org/archive/21/docs/jarray.html">jarray documentation</a>.)
</p><p>Now make a new IndexColorModel (that's what ImageJ's ij.process.LUT class is) for 8-bit images:
</p>
<pre class="brush:python">
channel = zeros(256, 'b')
for i in range(256):
    channel[i] = (i -128) 
cm = LUT(channel, channel, channel)
</pre>
<p>... and compose a ByteProcessor from the pixels, and assign it to an ImagePlus:
</p>
<pre class="brush:python">
imp = ImagePlus("Random", ByteProcessor(width, height, pix, cm))
imp.show()
</pre>
<h4><span class="mw-headline" id="Creating_a_random_image.2C_the_easy_way">Creating a random image, the easy way</span></h4>
<p>All the above can be summarized like the following:
</p>
<pre class="brush:python">
from java.util import Random
imp = IJ.createImage("A Random Image", "8-bit", 512, 512, 1)
Random().nextBytes(imp.getProcessor().getPixels())
imp.show()
</pre>
<h3><span class="mw-headline" id="Running_a_watershed_plugin_on_an_image">Running a watershed plugin on an image</span></h3>
<pre class="brush:python">
# 1 - Obtain an image
blobs = IJ.openImage("https://imagej.net/images/blobs.gif")
# Make a copy with the same properties as blobs image:
imp = blobs.createImagePlus()
ip = blobs.getProcessor().duplicate()
imp.setProcessor("blobs copy", ip)

# 2 - Apply a threshold: only zeros and ones
# Set the desired threshold range: keep from 0 to 74
ip.setThreshold(147, 147, ImageProcessor.NO_LUT_UPDATE)
# Call the Thresholder to convert the image to a mask
IJ.run(imp, "Convert to Mask", "")

# 3 - Apply watershed
# Create and run new EDM object, which is an Euclidean Distance Map (EDM)
# and run the watershed on the ImageProcessor:
EDM().toWatershed(ip)

# 4 - Show the watersheded image:
imp.show()
</pre>
<p>The EDM plugin that contains the watershed could have been indirectly applied to the currently active image, which is <i>not</i> recommended:
</p>
<pre class="brush:python">
imp = IJ.getImage()  # the current image
imp.getProcessor().setThreshold(174, 174, ImageProcessor.NO_LUT_UPDATE)
IJ.run(imp, "Convert to Mask", "")
IJ.run(imp, "Watershed", "")
</pre>
<p>If you had called <i>show()</i> on the image at any early stage, just update the screen with:
</p>
<pre class="brush:python">
imp.updateAndDraw()
</pre>
<p><br />
</p>
<h4><span class="mw-headline" id="..._and_counting_particles.2C_and_measuring_their_areas">... and counting particles, and measuring their areas</span></h4>
<p>Continuing from the <i>imp</i> above, that contains the now watersheded "blobs" sample image:
</p>
<pre class="brush:python">
# Create a table to store the results
table = ResultsTable()
# Create a hidden ROI manager, to store a ROI for each blob or cell
roim = RoiManager(True)
# Create a ParticleAnalyzer, with arguments:
# 1. options (could be SHOW_ROI_MASKS, SHOW_OUTLINES, SHOW_MASKS, SHOW_NONE, ADD_TO_MANAGER, and others; combined with bitwise-or)
# 2. measurement options (see [https://imagej.net/developer/api/ij/measure/Measurements.html Measurements])
# 3. a ResultsTable to store the measurements
# 4. The minimum size of a particle to consider for measurement
# 5. The maximum size (idem)
# 6. The minimum circularity of a particle
# 7. The maximum circularity
pa = ParticleAnalyzer(ParticleAnalyzer.ADD_TO_MANAGER, Measurements.AREA, table, 0, Double.POSITIVE_INFINITY, 0.0, 1.0)
pa.setHideOutputImage(True)

if pa.analyze(imp):
  print "All ok"
else:
  print "There was a problem in analyzing", blobs

# The measured areas are listed in the first column of the results table, as a float array:
areas = table.getColumn(0)

</pre>
<p>To print out the area measurement of each:
</p>
<pre>&gt;&gt;&gt; for area in areas: print area
76.0
185.0
658.0
434.0
...
</pre>
<p><br />
Now, we want to measure the intensity of each particle. To do so, we'll retrieve the ROI from the ROIManager, set them one at a time on the original (non-watershed, non-thresholded) image stored in the variable <i>blobs</i>, and measure:
</p>
<pre class="brush:python">
# Create a new list to store the mean intensity values of each blob:
means = []

for roi in RoiManager.getInstance().getRoisAsArray():
  blobs.setRoi(roi)
  stats = blobs.getStatistics(Measurements.MEAN)
  means.append(stats.mean)
</pre>
<p>Finally read out the measured mean intensity value of each blob, along with its area:
</p>
<pre class="brush:python">
for area, mean in zip(areas, means):
  print area, mean
</pre>
<pre>6.0 191.47368421052633
185.0 179.2864864864865
658.0 205.61702127659575
434.0 217.32718894009216
477.0 212.1425576519916
...
</pre>
<h3><span class="mw-headline" id="Creating_an_image_from_a_text_file">Creating an image from a text file</span></h3>
<p>A data file containing rows with 4 columns:
</p>
<pre>...
399 23 30 10.12
400 23 30 12.34
...
</pre>
<p>... where the columns are X, Y, Z and value, for every pixel in the image.
We assume we know the width and height of the image.
From this sort of data, we create an image, read out all lines and parse the numbers:
</p>
<pre class="brush:python">
width = 512
height = 512
stack = ImageStack(width, height)

file = open("/home/albert/Desktop/data.txt", "r")

try:
  fp = FloatProcessor(width, height)
  pix = fp.getPixels()
  cz = 0
  # Add as the first slice:
  stack.addSlice(str(cz), fp)
  # Iterate over all lines in the text file:
  for line in file.readlines():
    x, y, z, value = line.split(" ")
    x = int(x)
    y = int(y)
    z = int(z)
    value = float(value)
    # Advance one slice if the Z changed:
    if z&#160;!= cz:
      # Next slice
      fp = FloatProcessor(width, height)
      pix = fp.getPixels()
      stack.addSlice(str(cz), fp)
      cz += 1
    # Assign the value:
    pix[y * width + x] = value
  # Prepare and show a new image:  
  imp = ImagePlus("parsed", stack)
  imp.show()
# Ensure closing the file handle even if an error is thrown:
finally:
  file.close()
</pre>
<p><br />
</p>
<h3><span class="mw-headline" id="Obtain.2FView_histogram_and_measurements_from_an_image">Obtain/View histogram and measurements from an image</span></h3>
<p>The easiest way is to grab an image and call an ImageJ command to show its histogram:
</p>
<pre class="brush:python">
imp = IJ.openImage("https://imagej.net/images/blobs.gif")
IJ.run(imp, "Histogram", "")
</pre>
<p>How ImageJ does it, internally, has to do with the <a rel="nofollow" class="external text" href="developer/api/ij/process/ImageStatistics.html">ImageStatisics</a> class:
</p>
<pre class="brush:python">
stats = imp.getStatistics()
print stats.histogram
</pre>
<pre>array('i',[0, 0, 0, 0, 0, 0, 0, 0, 53, 0, 0, 0, 0, 0, 0, 0, 304,
           0, 0, 0, 0, 0, 0, 0, 1209, 0, 0, 0, 0, 0, 0, 0, 3511, 0,
           0, 0, 0, 0, 0, 0, 7731, 0, 0, 0, 0, 0, 0, 0, 10396, 0, 0,
           0, 0, 0, 0, 0, 7456, 0, 0, 0, 0, 0, 0, 0, 3829, 0, 0, 0,
           0, 0, 0, 0, 1992, 0, 0, 0, 0, 0, 0, 0, 1394, 0, 0, 0, 0,
           0, 0, 0, 1158, 0, 0, 0, 0, 0, 0, 0, 1022, 0, 0, 0, 0, 0,
           0, 0, 984, 0, 0, 0, 0, 0, 0, 0, 902, 0, 0, 0, 0, 0, 0,
           0, 840, 0, 0, 0, 0, 0, 0, 0, 830, 0, 0, 0, 0, 0, 0, 0,
           926, 0, 0, 0, 0, 0, 0, 0, 835, 0, 0, 0, 0, 0, 0, 0, 901,
           0, 0, 0, 0, 0, 0, 0, 1025, 0, 0, 0, 0, 0, 0, 0, 1180, 0,
           0, 0, 0, 0, 0, 0, 1209, 0, 0, 0, 0, 0, 0, 0, 1614, 0, 0,
           0, 0, 0, 0, 0, 1609, 0, 0, 0, 0, 0, 0, 0, 2220, 0, 0, 0,
           0, 0, 0, 0, 2037, 0, 0, 0, 0, 0, 0, 0, 2373, 0, 0, 0, 0,
           0, 0, 0, 1568, 0, 0, 0, 0, 0, 0, 0, 1778, 0, 0, 0, 0, 0,
           0, 0, 774, 0, 0, 0, 0, 0, 0, 0, 1364, 0, 0, 0, 0, 0, 0, 0])
</pre>
<p><br />
The histogram, area and mean are computed by default. Other values like the median need to be specified.
</p><p>To calculate other parameters, specify them by bitwise-or composition (see flags in <a rel="nofollow" class="external text" href="developer/api/ij/measure/Measurements.html">Measurements</a>):
</p>
<pre class="brush:python">
stats = imp.getStatistics(Measurements.MEAN | Measurements.MEDIAN | Measurements.AREA)
print "mean:", stats.mean, "median:", stats.median, "area:", stats.area
</pre>
<pre>mean: 103.26857775590551 median: 64.0 area: 65024.
</pre>
<p><br />
If we set a ROI to the image, then we are measuring only for the inside of the ROI. Here we set an oval ROI of radius 25 pixels, centered:
</p>
<pre class="brush:python">
radius = 25
roi = OvalRoi(imp.width/2 - radius, imp.height/2 -radius, radius*2, radius*2)
imp.setRoi(roi)
stats = imp.getStatistics(Measurements.MEAN | Measurements.MEDIAN | Measurements.AREA)
print "mean:", stats.mean, "median:", stats.median, "area:", stats.area
</pre>
<pre>mean: 104.96356275303644 median: 64.0 area: 1976.0
</pre>
<p><br />
</p><p>To display the histogram window ourselves, we may use the <a rel="nofollow" class="external text" href="developer/api/ij/gui/HistogramWindow.html">HistogramWindow</a> class:
</p>
<pre class="brush:python">
hwin = HistogramWindow(imp)
</pre>
<p>... of which we may grab the image (the plot itself) and save it:
</p>
<pre class="brush:python">
plotimage = hwin.getImagePlus()
IJ.save(plotimage, "/path/to/our/folder/plot.tif")
</pre>
<h3><span class="mw-headline" id="Removing_bleeding_from_one_channel_to_another">Removing bleeding from one channel to another</span></h3>
<p>The technique to use is to divide one channel by the other: the channel to denoise divided by the channel that bled through.
</p><p>The relatively high-level way to do it is to split the channels and call the ImageCalculator with a "Divide" argument:
</p>
<pre class="brush:python">
# 1 - Obtain an RGB image stack
imp = WindowManager.getCurrentImage()
if imp.getType()&#160;!= ImagePlus.COLOR_RGB:
  IJ.showMessage("The active image is not RGB!")
  raise RuntimeException("The active image is not RGB!")

if 1 == imp.getNSlices():
  IJ.showMessage("Not a stack!")
  raise RuntimeException("Not a stack!")

# 2 - Prepare stacks to split slices
stack = imp.getStack()
red_stack = ImageStack(imp.width, imp.height)
green_stack = ImageStack(imp.width, imp.height)

# 3 - Iterate all slices -- notice slices are 1&lt;=i&lt;=size
for i in range(1, imp.getNSlices()+1):
  slice = stack.getProcessor(i)
  red_stack.addSlice(str(i), slice.toFloat(0, None))
  green_stack.addSlice(str(i), slice.toFloat(1, None))

# 4 - Apply "divide" via ImageCalculator to the red_stack, which is a new 32-bit stack
# Don't use the parameters "create" or "float" or "32" in the parameters string
# of the calc.calculate call--then the result of the operation would be
# in a new stack that opens beyond our control. Without them, results are
# applied to the red_stack
calc = ImageCalculator()
calc.calculate("Divide stack", ImagePlus("red", red_stack), ImagePlus("green", green_stack))

# 5 - Compose a new color stack
new_stack = ImageStack(imp.width, imp.height)
for i in range(1, imp.getNSlices()+1):
  cp = stack.getProcessor(i).duplicate()
  cp.setPixels(0, red_stack.getProcessor(i))
  new_stack.addSlice(stack.getSliceLabel(i), cp)

# 6 - Show the new image
ImagePlus("Normalized " + imp.title, new_stack).show()
</pre>
<p><br />
Alternatively and as an example of direct pixel manipulation, we'll iterate all slices of the image stack, divide the red channel by the green channel, and compose a new stack:
</p>
<pre class="brush:python">
# 1 - Obtain an RGB image stack
imp = WindowManager.getCurrentImage()
if imp.getType()&#160;!= ImagePlus.COLOR_RGB:
  IJ.showMessage("The active image is not RGB!")
  raise RuntimeException("The active image is not RGB!")

if 1 == imp.getNSlices():
  IJ.showMessage("Not a stack!")
  raise RuntimeException("Not a stack!")

stack = imp.getStack()

# 2 - Create a new stack to store the result
new_stack = ImageStack(imp.width, imp.height)

# 3 - Iterate all slices -- notice slices are 1&lt;=i&lt;=size
for i in range(1, imp.getNSlices()+1):
  # Get the slice i
  slice = stack.getProcessor(i)
  # Get two new FloatProcessor with the green and red channel data in them
  red = slice.toFloat(0, None)
  green = slice.toFloat(1, None)
  pix_red = red.getPixels()
  pix_green = green.getPixels()
  # Create a new FloatProcessor for the normalized result
  new_red = FloatProcessor(imp.width, imp.height)
  pix_new_red = new_red.getPixels()
  # Iterate and set all normalized pixels
  for k in range(len(pix_red)):
    if 0&#160;!= pix_green[k]:
      pix_new_red[k] = pix_red[k] / pix_green[k]
  # Create a ColorProcessor that has the normalized red and the same green and blue channels
  cp = slice.duplicate()
  cp.setPixels(0, new_red)   # at channel 0, the red
  # Store the normalized slice in the new stack, copying the same slice label
  new_stack.addSlice(stack.getSliceLabel(i), cp)

# 4 - Show the normalized stack
new_imp = ImagePlus("Normalized " + imp.title, new_stack)
new_imp.show()
</pre>
<p>Notice that this second approach is much slower: accessing every pixel from jython has a high cost. If you would like to do very fast pixel-level manipulations, use java or <a href="Clojure_Scripting" title="Clojure Scripting">Clojure</a>.
</p>
<h3><span class="mw-headline" id="Subtract_the_minimal_value_to_an_image">Subtract the minimal value to an image</span></h3>
<p>Which is to say, translate the histogram so that the lowest value is at zero.
</p>
<pre class="brush:python">
# Obtain current image and its pixels
imp = IJ.getImage()
pix = imp.getProcessor().convertToFloat().getPixels()

# find out the minimal pixel value
min = reduce(Math.min, pix)

# create a new pixel array with the minimal value subtracted
pix2 = map(lambda x: x - min, pix)

ImagePlus("min subtracted", FloatProcessor(imp.width, imp.height, pix2, None)).show()
</pre>
<p>Notice we used:
</p>
<ul><li> The <i>reduce</i> function to obtain a single value from a list of values (the pixel array) by applying a function to every pair of consecutive values (in this case, the Math.min).</li>
<li> <i>lambda</i>, which is used to declare an anonymous function that takes one argument.</li>
<li> The <i>map</i> function, which runs a function given as argument to every element of a list (here, every pixel) and returns a new list with all the results.</li></ul>
<h3><span class="mw-headline" id="Extract_a_specific_color_channel_for_a_given_time_frame_of_a_composite_image">Extract a specific color channel for a given time frame of a composite image</span></h3>
<p>Suppose you have a 4D multicolor image, and want to obtain a stack of slices corresponding to a specific color channel and time frame.
</p><p>The <a rel="nofollow" class="external text" href="https://fiji.sc/javadoc/ij/CompositeImage.html">CompositeImage</a> is a stack whose slices are interpreted as belonging to specific color channels, Z slices and time frames. To find out which slice corresponds to what, use the <i>getStackIndex</i> method of the <a rel="nofollow" class="external text" href="https://fiji.sc/javadoc/ij/ImagePlus.html">ImagePlus</a>, which translates between color channels, z slices and time frames to the slice index in the underlying <a rel="nofollow" class="external text" href="https://fiji.sc/javadoc/ij/ImageStack.html">ImageStack</a>.
</p>
<pre class="brush:python">
from ij import IJ, ImagePlus, ImageStack

def extractChannel(imp, nChannel, nFrame):
 """ Extract a stack for a specific color channel and time frame """
 stack = imp.getImageStack()
 ch = ImageStack(imp.width, imp.height)
 for i in range(1, imp.getNSlices() + 1):
   index = imp.getStackIndex(nChannel, i, nFrame)
   ch.addSlice(str(i), stack.getProcessor(index))
 return ImagePlus("Channel " + str(nChannel), ch)

imp = IJ.getImage()
extractChannel(imp, 1, 1).show()
</pre>
<p>Notice that color channels, stack slices and time frames are all 1-based. For example, if you have 3 color channels, then these have indices 1, 2, and 3 (not 0, 1 and 2).
</p><p><br />
</p>
<h3><span class="mw-headline" id="Visualize_any_number_of_TIFF_stacks_in_a_single_composite_multi-color_image_stack">Visualize any number of TIFF stacks in a single composite multi-color image stack</span></h3>
<p>Suppose you have 1000 stacks of <i>Drosophila</i> fly brains, each with different neurons labeled in a single color channel. Suppose that you have registered all these confocal stacks. Were you to overlay them, you would see whether the labeled neurons overlap in 3D space or not.
</p><p>Here is a script to do that. First, it asks for a directory containing any number of TIF image stacks. It assumes all stacks have the same dimensions, and that they are all single channel (i.e. just red, or just green, etc.). Then, it displays a small window with a listing of many colors: red, green, blue, orange, gray, etc. Any of the hundreds of stacks in the directory can be assigned to each color channel.
</p><p>The stacks are accessed in a virtual way, so even 1000 (one thousand) stacks will be managed just fine in small laptop.
</p><p>One could easily add more color channels. But there are already lots.
</p><p>The script uses <a href="Imglib" class="mw-redirect" title="Imglib">Imglib</a> scripting to normalize images and generate the color composite. See this <a rel="nofollow" class="external text" href="http://www.ini.uzh.ch/~acardona/fiji-tutorial/#s10">imglib scripting tutorial</a> for in-depth explanations.
</p>
<div class="MediaTransformError" style="width: 579px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div>
<pre class="brush:python">
# 2010-12-03 Albert Cardona and Arnim Jenett
# At HHMI Janelia Farm, Fiji tutorials class
#
# Select a directory with multiple image stacks
# all of the same dimensions, and show a channel
# chooser window to visualize up to 5 of them
# in red, green, blue, orange, and gray.
# 
# The stacks are all virtual, opened via LOCI
# with BFVirtualStack. The composition of the
# RGB ColorProcessor is done with the 
# script.imglib library.
# 
# Each color channel is shown normalized.
# Currently works only with TIF stacks,
# and it will interpret them as single-channel.


from loci.plugins.util import BFVirtualStack
from loci.formats import ChannelSeparator
from ij.io import DirectoryChooser
import os
from javax.swing import JScrollPane, JPanel, JComboBox, JLabel, JFrame
from java.awt import Color, GridLayout
from java.awt.event import ActionListener
from script.imglib.math import Compute, Max, Multiply
from script.imglib.algorithm import Normalize
from script.imglib.color import Red, Green, Blue, RGBA
from mpicbg.imglib.image.display.imagej import ImageJFunctions as IJF


# Choose a directory with lots of tif stacks
dc = DirectoryChooser("Choose directory with stacks")
srcDir = dc.getDirectory()

# Open each tif stack as a virtual BFVirtualStack
bfvs = []
names = []
for filename in os.listdir(srcDir):
  if filename.endswith(".tif"):
    print "Reading metadata from", filename
    cs = ChannelSeparator()
    names.append(filename)
    cs.setId(srcDir + filename)
    bfvs.append( BFVirtualStack(srcDir + filename, cs, False, False, False) )

names.sort()
names = ["None"] + names


colorToRGB = {
'Red'&#160;: [255,0,0],
'Green'&#160;: [0,255,0],
'Blue'&#160;: [0,0,255],
'Orange'&#160;: [255,127,0],
'Cyan'&#160;: [0,255,255],
'Yellow'&#160;: [255,255,0],
'Magenta'&#160;: [255,0,255],
'Indigo'&#160;: [75,0,130],
'Violet'&#160;: [238,130,238],
'Greyscale'&#160;: [255,255,255],
'Aquamarine'&#160;: [127,255,212],
'Navy Blue'&#160;: [0,0,128],
'Sky Blye'&#160;: [135,206,235],
'Turquoise'&#160;: [64,224,208],
'Beige'&#160;: [245,245,220],
'Brown'&#160;: [165,42,42],
'Chocolate'&#160;: [210,105,30],
'Dark wood'&#160;: [133,94,66],
'Light wood'&#160;: [133,99,99],
'Olive'&#160;: [128,128,0],
'Green yellow'&#160;: [173,255,47],
'Sea green'&#160;: [32,178,170],
'Khaki'&#160;: [240,230,140],
'Salmon'&#160;: [250,128,114],
'Pink'&#160;: [255,192,203],
'Tomato'&#160;: [255,99,71],
'Scarlet'&#160;: [140,23,23],
'Purple'&#160;: [128,0,128],
'Wheat'&#160;: [245,222,179],
'Silver grey'&#160;: [192,192,192]
}

# Encode color RGB in floats:
tmp = {}
for c,rgb in colorToRGB.iteritems():
  tmp[c] = [v/255.0 for v in rgb]
colorToRGB = tmp

# Colors in the desired listing order:
colors = ['Red', 'Green', 'Blue',
          'Orange', 'Indigo',
          'Cyan', 'Yellow', 'Magenta',
          'Turquoise', 'Tomato', 'Olive',
          'Violet', 'Green yellow', 'Khaki',
          'Scarlet', 'Beige', 'Chocolate',
          'Silver grey', 'Pink', 'Wheat',
          'Sea green', 'Greyscale', 'Light wood',
          'Sky Blye', 'Brown', 'Salmon', 'Navy Blue',
          'Aquamarine', 'Purple', 'Dark wood']

# Initalize table of colors vs stacks to use:
table = {}
for k,v in zip(colors, [1] + [0 for i in range(len(colors)-1)]):
  table[k] = v


def asImg(color, section):
  global bfvs, table
  index = table[color]
  if 0 == index:
    return 0  # is "None" color
  return IJF.wrap(ImagePlus("", bfvs[index-1].getProcessor(section)))

def maybeNormalize(fn):
  """ Do not normalize if no images are present. """
  if 0 == fn:
    return fn
  cursors = []
  fn.findCursors(cursors)
  if len(cursors) &gt; 0:
    return Multiply(Normalize(fn), 255)
  return fn

def blendColors(section):
  global bfvs, table, colorToRGB
  red =  0
  green = 0
  blue = 0
  for colorName,index in table.iteritems():
    if 0 == index: continue
    img = IJF.wrap(ImagePlus("", bfvs[index-1].getProcessor(section)))
    rgb = colorToRGB[colorName]
    if 0&#160;!= rgb[0]:
      red = Max(red, Multiply(img, rgb[0]))
    if 0&#160;!= rgb[1]:
      green = Max(green, Multiply(img, rgb[1]))
    if 0&#160;!= rgb[2]:
      blue = Max(blue, Multiply(img, rgb[2]))
  return red, green, blue

class VS(VirtualStack):
  def __init__(self):
    self.last = None
  def getProcessor(self, i):
    """ Channel color composition into a single RGB image, as ColorProcessor. 'i' is the section index, 1&lt;=i&lt;=size """
    red, green, blue = blendColors(i)
    # Transform to RGB by normalizing and scaling to 255
    red = maybeNormalize(red)
    green = maybeNormalize(green)
    blue = maybeNormalize(blue)
    # Compose
    rgb = RGBA(red, green, blue).asImage()
    self.last = IJF.displayAsVirtualStack(rgb).getProcessor()
    return self.last
  def getSize(self):
    return bfvs[0].getSize()
  def getSliceLabel(self, i):
    return str(i)
  def getWidth(self):
    return self.last.getWidth()
  def getHeight(self):
    return self.last.getHeight()
  def getPixels(self, i):
    return self.getProcessor(i).getPixels()
  def setPixels(self, pix, i):
    pass


# Create a new image stack
print os.path.split(srcDir)
ourImp = ImagePlus(os.path.split(srcDir)[1], VS())
ourImp.show()

# Create a bunch of panels, one for each color channel
all = JPanel()
layout = GridLayout(len(colors), 2)
all.setLayout(layout)

# GUI to choose which stacks is shown in which channel
class Listener(ActionListener):
  def __init__(self, color, choice, imp):
    self.color = color
    self.choice = choice
    self.imp = imp
  def actionPerformed(self, event):
    global table
    table[self.color] = self.choice.getSelectedIndex()
    self.imp.updateAndRepaintWindow()

for color in colors:
  all.add(JLabel(color))
  choice = JComboBox(names)
  choice.setSelectedIndex(table[color])
  choice.addActionListener(Listener(color, choice, ourImp))
  all.add(choice)

frame = JFrame("Channels")
frame.getContentPane().add(JScrollPane(all))
frame.pack()

frame.setVisible(True)
</pre>
<h3><span class="mw-headline" id="Sort_all_points_of_a_PointRoi_into_a_chain_by_distance_to_each_other">Sort all points of a PointRoi into a chain by distance to each other</span></h3>
<p>There may be better ways, but here is one. Read the header to understand its limitations.
</p>
<pre class="brush:python">
# Albert Cardona 2010-12-17 for Victoria Butler at HHMI Janelia Farm
# Given a PointRoi, order the points in a chain
# Assumes that the point furthest from all points
# is the start or the end of the chain.

from javax.vecmath import Point2f

# Obtain the PointRoi of the current image
proi = IJ.getImage().getRoi()

# Interrupt if the ROI is not a PointRoi instance:
if proi.getClass()&#160;!= PointRoi:
  raise Exception("Not a PointRoi!")

class Point(Comparable):
  def __init__(self, x, y):
    self.p = Point2f(x, y)
    self.distances = {}
    self.distAll = None
  def distance(self, point):
    return self.p.distance(point.p)
  def distanceToAll(self):
    if self.distAll is None:
      self.distAll = reduce(lambda a, b: a + b, self.distances.values())
    return self.distAll
  def compareTo(self, point):
    if self.distanceToAll() &lt; point.distanceToAll():
      return -1
    return 1
  def toString(self):
    return self.p.toString()
  def closest(self, points):
    """ Find the closest point that is not contained in the set of given points. """
    next = None
    dist = Float.MAX_VALUE
    for p,d in self.distances.iteritems():
      if d &lt; dist and not p in points:
        next = p
        dist = d
    return next

# Convert PointRoi points to Point instances
px = proi.getXCoordinates()
py = proi.getYCoordinates()
bounds = proi.getBounds()
points = []
for i in range(proi.getNCoordinates()):
  points.append(Point(bounds.x + px[i], bounds.y + py[i]))

# Precompute all-to-all distances
allToAll = {}
for j in range(len(points)):
  for k in range(j+1, len(points)):
    distance = points[j].distance(points[k])
    points[j].distances[points[k]] = distance
    points[k].distances[points[j]] = distance

# Choose a starting point.
# In this case, we use the point most distant from all other points
points.sort()
first = points[-1]
print "First:", first

# Grow the chain from the starting point
chain = [first]
seen = set() # for fast look-up
seen.add(chain[0])
while len(chain) &lt; len(points):
  next = chain[-1].closest(seen)
  if next is None:
    break
  chain.append(next)
  seen.add(next)

print "Chain:", chain
</pre>
<h3><span class="mw-headline" id="Correct_illumination_in_a_stack:_apply_the_illumination_of_one_slice_to_all_others">Correct illumination in a stack: apply the illumination of one slice to all others</span></h3>
<p>The Multi-focus 3D Microscope (Sara Abrahamsson and Matz Gustafsson) takes a single image and later, computationally, 9 image planes are extracted.
</p><p>The middle slice usually has the desired illumination levels, while the other 8 slices (4 before and 4 after) do not. Here is a script to apply the illumination of the 5th slice to all other slices.
</p><p>The script takes a directory of images and processed them all, resulting in new images stored as "*-corrected.tif" in the same directory.
</p>
<pre class="brush:python">
# Albert Cardona 2011-06-09 at HHMI Janelia Farm
# Takes a stack of 9 slices
# and then computes the mean and stdDev of slice number 5
# and normalize the intensity of the other 8 slices
# to that of slice 5.
#
# Created for Jiji Chen to process image stacks from
# the multifocus 3D microscope from Matz Gustafsson
# and Sara Abrahamsson


from math import sqrt
import os

def computeMean(pixels):
  return sum(pixels) / float(len(pixels))

def computeStdDev(pixels, mean):
  s = 0
  for i in range(len(pixels)):
    s += pow(pixels[i] - mean, 2)
  return sqrt(s / float(len(pixels) -1))

def process9ImagePlanes(imp):
  # reference slice
  refSlice = 5
  ref = imp.getStack().getProcessor(5)
  refMean = sum(ref.getPixels()) / float(len(ref.getPixels()))
  refStdDev = computeStdDev(ref.getPixels(), refMean)

  # New stack with the corrected slices
  stack = ImageStack(ref.width, ref.height)

  for i in range(1, 10):
    # skip the reference slice
    if 5 == i:
      stack.addSlice(imp.getStack().getSliceLabel(5), ref.convertToFloat())
      continue
    ip = imp.getStack().getProcessor(i).convertToFloat()
    mean = computeMean(ip.getPixels())
    stdDev = computeStdDev(ip.getPixels(), mean)
    ip.add(-mean)
    ip.multiply(1/stdDev)
    ip.multiply(refStdDev)
    ip.add(refMean)
    stack.addSlice(imp.getStack().getSliceLabel(i), ip)

  return ImagePlus(imp.title, stack)


def accept(filename):
  """ Work only with TIFF files. """
  return len(filename) - 4 == filename.rfind(".tif")

def run():
  dc = DirectoryChooser("pick folder with image stacks")
  folder = dc.getDirectory()
  if folder is None:
    return
  for filename in filter(accept, os.listdir(folder)):
    imp = IJ.openImage(os.path.join(folder, filename))
    if imp is None:
      print "Failed to open image:", filename
      continue
    corrected = process9ImagePlanes(imp)
    IJ.save(corrected, os.path.join(folder, filename[0:-4] + "-corrected.tif"))

run()

</pre>
<p><br />
</p>
<h3><span class="mw-headline" id="Add_a_mouse_listener_to_the_canvas_of_every_open_image">Add a mouse listener to the canvas of every open image</span></h3>
<pre class="brush:python">
from java.awt.event import MouseAdapter

def doSomething(imp):
 """ A function to react to a mouse click on an image canvas. """
 IJ.log("clicked on: " + str(imp))

class ML(MouseAdapter):
 def mousePressed(self, event):
   canvas = event.getSource()
   imp = canvas.getImage()
   doSomething(imp)

listener = ML()

for imp in map(WindowManager.getImage, WindowManager.getIDList()):
 win = imp.getWindow()
 if win is None:
   continue
 win.getCanvas().addMouseListener(listener)
</pre>
<p>After running the script, clicking on any image will result in
printing a line to the log window, like:
</p>
<pre> clicked on: imp[Untitled-1 400x200x1]
</pre>
<p><br />
</p>
<h3><span class="mw-headline" id="Add_a_key_listener_to_the_canvas_of_every_open_image">Add a key listener to the canvas of every open image</span></h3>
<pre class="brush:python">
from ij import IJ, WindowManager
from java.awt.event import KeyEvent, KeyAdapter
 
def doSomething(imp, keyEvent):
  """ A function to react to key being pressed on an image canvas. """
  IJ.log("clicked keyCode " + str(keyEvent.getKeyCode()) + " on image " + str(imp))
  # Prevent further propagation of the key event:
  keyEvent.consume()

class ListenToKey(KeyAdapter):
  def keyPressed(this, event):
    imp = event.getSource().getImage()
    doSomething(imp, event)
 
listener = ListenToKey()
 
for imp in map(WindowManager.getImage, WindowManager.getIDList()):
  win = imp.getWindow()
  if win is None:
    continue
  canvas = win.getCanvas()
  # Remove existing key listeners
  kls = canvas.getKeyListeners()
  map(canvas.removeKeyListener, kls)
  # Add our key listener
  canvas.addKeyListener(listener)
  # Optionally re-add existing key listeners
  # map(canvas.addKeyListener, kls)
</pre>
<h3><span class="mw-headline" id="Create_a_virtual_stack_from_the_TIF_files_present_in_a_folder_and_its_subfolders.2C_recursively">Create a virtual stack from the TIF files present in a folder and its subfolders, recursively</span></h3>
<pre class="brush:python">
# Walk recursively through an user-selected directory
# and add all found filenames that end with ".tif"
# to a VirtualStack, which is then shown.
#
# It is assumed that all images are of the same type
# and have the same dimensions.

import os
from ij.io import DirectoryChooser
from ij import IJ, ImagePlus, VirtualStack

def run():
  srcDir = DirectoryChooser("Choose!").getDirectory()
  if not srcDir:
    # user canceled dialog
    return
  # Assumes all files have the same size
  vs = None
  for root, directories, filenames in os.walk(srcDir):
    for filename in filenames:
      # Skip non-TIFF files
      if not filename.endswith(".tif"):
        continue
      path = os.path.join(root, filename)
      # Upon finding the first image, initialize the VirtualStack
      if vs is None:
        imp = IJ.openImage(path)
        vs = VirtualStack(imp.width, imp.height, None, srcDir)
      # Add a slice, relative to the srcDir
      vs.addSlice(path[len(srcDir):])
  #
  ImagePlus("Stack from subdirectories", vs).show()

run()
</pre>
<h3><span class="mw-headline" id="Open_the_slices_of_a_very_large_multi-image_stack_file_one_by_one.2C_and_save_each_as_a_new_image_file">Open the slices of a very large multi-image stack file one by one, and save each as a new image file</span></h3>
<pre class="brush:python">
# 2011-10-18 Albert Cardona for Nuno da Costa
# Choose a multi-slice image stack file in a virtual way
# and save each slice as an individual image file
# in a user-chosen directory.

import os
from loci.plugins.util import BFVirtualStack
from loci.formats import ChannelSeparator

def run():
  # Choose a file to open
  od = OpenDialog("Choose multi-image file", None)
  srcDir = od.getDirectory()
  if srcDir is None:
    # User canceled the dialog
    return
  path = os.path.join(srcDir, od.getFileName())
  # Choose a directory to store each slice as a file
  targetDir = DirectoryChooser("Choose target directory").getDirectory()
  if targetDir is None:
    # User canceled the dialog
    return
  # Ready:
  cs = ChannelSeparator()
  cs.setId(path)
  bf = BFVirtualStack(path, cs, False, False, False)
  for sliceIndex in xrange(1, bf.getSize() +1):
    print "Processing slice", sliceIndex
    ip = bf.getProcessor(sliceIndex)
    sliceFileName = os.path.join(targetDir, str(sliceIndex) + ".tif")
    FileSaver(ImagePlus(str(sliceIndex), ip)).saveAsTiff(sliceFileName)

run()
</pre>
<p><br />
</p>
<h3><span class="mw-headline" id="Apply_a_binary_mask_to_every_slice_in_an_image_stack">Apply a binary mask to every slice in an image stack</span></h3>
<p>Will work with regular stacks and with any kind of complex stack like a composite image or a 4d volume. Keep in mind that all stack types in ImageJ consists of a sequence of 2d images, each editable with an <a rel="nofollow" class="external text" href="developer/api/ij/process/ImageProcessor.html">ImageProcessor</a> obtained from the <a rel="nofollow" class="external text" href="developer/api/ij/ImageStack.html">ImageStack</a> that one can get from the <a rel="nofollow" class="external text" href="developer/api/ij/ImagePlus.html">ImagePlus</a>. (The <a rel="nofollow" class="external text" href="developer/api/ij/ImagePlus.html">ImagePlus</a> being what the opener or the <a rel="nofollow" class="external text" href="developer/api/ij/WindowManager.html">WindowManager</a> provides.)
</p>
<pre class="brush:python">
# Albert Cardona 2012-10-05 for Sara Abrahamsson
#
# Take a stack of images and a mask,
# and clear the area outside the mask for every image.
#
# ASSUMES that the mask:
# 1. Is 8-bit;
# 2. has the area to keep as 255;
# 3. has the area to clear as zeros.


from ij import IJ
from ij import WindowManager as WM

# If the images are open:
volume = WM.getImage("stack.tif")
mask = WM.getImage("mask.tif")

# Or if the images have to be loaded from files:
# volume = IJ.openImage("/Users/sara/images/stack.tif")
# mask = IJ.open("/Users/sara/images/mask.tif")

# Obtain the underlying stack of 2d images
stack = volume.getStack()

# Fill every stack slice with zeros for the area outside the mask
for i in xrange(1, stack.getSize() + 1):
  # ip is the ImageProcessor for one stack slice
  ip = stack.getProcessor(i)
  ip.setValue(0)
  ip.fill(mask)

volume.updateAndDraw()
volume.show()
</pre>
<p>Note that it is counterintuitive that the area outside the mask gets filled with zeros. If you want the area inside the mask to get filled with zeros, then add this step before the loop:
</p>
<pre class="brush:python">
mask = mask.duplicate()
mask.invert()
</pre>
<h3><span class="mw-headline" id="Open_all_series_in_a_LIF_file_with_Bio-Formats">Open all series in a LIF file with Bio-Formats</span></h3>
<pre class="brush:python">

# 2014-11-24 Harri Jlinoja

from loci.plugins.in import ImagePlusReader,ImporterOptions,ImportProcess
import sys

filename = sys.argv[1]
opts = ImporterOptions()
opts.setId(filename)
opts.setUngroupFiles(True)

# set up import process
process = ImportProcess(opts)
process.execute()
nseries = process.getSeriesCount()

# reader belonging to the import process
reader = process.getReader()

# reader external to the import process
impReader = ImagePlusReader(process)
for i in range(0, nseries):
    print "%d/%d&#160;%s"&#160;% (i+1, nseries, process.getSeriesLabel(i))
    
    # activate series (same as checkbox in GUI)
    opts.setSeriesOn(i,True)

    # point import process reader to this series
    reader.setSeries(i)

    # read and process all images in series
    imps = impReader.openImagePlus()
    for imp in imps:
        imp.show()
        wait = Wait(str(i) + imp.getTitle())
        wait.show()
        imp.close()

    # deactivate series (otherwise next iteration will have +1 active series)
    opts.setSeriesOn(i, False)
</pre>
<p><br />
</p>
<h3><span class="mw-headline" id="Open_and_save_movies_with_the_FFMPEG_I.2FO_plugin">Open and save movies with the FFMPEG I/O plugin</span></h3>
<p>First note that the FFMPEG I/O plugin was a proof-of-concept that is completely <b>unmaintained</b>.
</p><p>Then open the <a href="Fiji_Updater" class="mw-redirect" title="Fiji Updater">Fiji Updater</a>, push the "Manage update sites" at the bottom left of the dialog, and install the <a rel="nofollow" class="external text" href="https://fiji.sc/~schindelin/ffmpeg-plugins/">FFMPEG</a> plugin by <a href="./User:Schindelin" title="User:Schindelin">Johannes Schindelin</a> by ticking its checkbox, as <a href="How_to_follow_a_3rd_party_update_site" class="mw-redirect" title="How to follow a 3rd party update site">explained in more detail here</a>.
</p><p>See also the Java source code for the <a rel="nofollow" class="external text" href="https://github.com/fiji/fiji/blob/8164ae68/native/FFMPEG_IO/plugin/src/main/java/fiji/ffmpeg/IO.java">IO</a> class from the <a rel="nofollow" class="external text" href="https://github.com/fiji/fiji/tree/8164ae68/native/FFMPEG_IO/plugin/src/main/java/fiji/ffmpeg/">FFMPEG plugin source code site</a>.
</p>
<pre class="brush:python">
""" Albert Cardona for Marta Zlatic, 2014-01-24. """

from fiji.ffmpeg import IO
from java.awt import Color
import os

def load(path, first_frame=0, last_frame=-1):
  """ Load the whole movie by default. """
  io = IO()
  imp = io.readMovie(path, False, first_frame, last_frame)
  return imp

def save(path, imp, frame_rate=30, bit_rate=400000):
  """ frame_rate in fps (frames per second).
      bit_rate defines the quality of the movie: higher bit rate results in larger, higher quality movies.
      The movie format (e.g. AVI, MPG, etc.) is chosen by the path filename extension. """
  io = IO()
  io.writeMovie(imp, path, frame_rate, bit_rate)


def process(imp, convert, roi, time_zero, time_range):
  """ Crop, convert to another format, and time-stamp. """
  stack = imp.getStack()
  size = stack.getSize()
  bounds = roi.getBounds()
  new_stack = ImageStack(bounds.width, bounds.height)
  for i in xrange(1, size + 1):
    ip = convert(stack.getProcessor(i))
    ip.setRoi(roi)
    c = ip.crop()
    c.setColor(Color.white)
    time = "%.2f"&#160;% (time_zero + time_range * (float(i-1) / (size -1)))
    c.drawString(time, 5, 15)
    new_stack.addSlice(str(i), c)

  return ImagePlus(imp.title, new_stack)


def batch_process(extension, source_dir, output_dir, convert, roi, time_zero, time_range):
  for filename in os.listdir(source_dir):
    if filename.endswith(extension):
      if os.path.exists(target_dir + filename):
        # Skip if movie exists at destination
        continue
      imp = load(source_dir + filename)
      imp2 = process(imp, convert, roi, time_zero, time_range)
      imp.flush()
      save(target_dir + filename, imp2)
      imp2.flush()


def convert(ip):
  """ Convert to 8=bit and crop the range to [0, 128] pixel values. """
  c = ip.convertToByte(True)
  c.setMinAndMax(0, 128)
  return c


source_dir = '/path/to/list_of_AVI_movies/'
target_dir = '/path/to/new_list_of_AVI_movies/'

roi = Roi(50, 50, 256, 256)
time_zero = 30   # start at 30 seconds
time_range = 30  # range of (also) 30 seconds

# Process all AVI movie files, saving them also as AVI files
batch_process('.avi', source_dir, target_dir, convert, roi, time_zero, time_range)

</pre>
<h3><span class="mw-headline" id="Skeletonize_an_image_and_analyze_the_skeleton">Skeletonize an image and analyze the skeleton</span></h3>
<pre class="brush:python">
from ij import IJ
from skeleton_analysis import AnalyzeSkeleton_,Graph,Edge,Vertex

# open image, blur, make b/w, skeletonize
imp = IJ.openImage("/path/to/image.tif")
IJ.run(imp,"Gaussian Blur...","sigma=5")
IJ.run(imp,"Make Binary","")
IJ.run(imp,"Skeletonize","")

# run AnalyzeSkeleton
# (see https://fiji.sc/AnalyzeSkeleton 
# and https://fiji.sc/javadoc/skeleton_analysis/package-summary.html)
skel = AnalyzeSkeleton_()
skel.setup("",imp)
skelResult = skel.run(skel.NONE, False, True, None, True, True)

# get the separate skeletons
graph = skelResult.getGraph()
print len(graph)
print skelResult.getNumOfTrees()

def getGraphLength(graph):
    length = 0
    for g in graph.getEdges():
    length = length + g.getLength()
    return length

# find the longest graph
graph = sorted(graph, key=lambda g: getGraphLength(g), reverse=True)
longestGraph = graph[0]

# find the longest edge
edges = longestGraph.getEdges()
edges = sorted(edges, key=lambda edge: edge.getLength(), reverse=True)
longestEdge = edges[0]

</pre>
<h3><span class="mw-headline" id="Find_peaks_in_a_3D_image">Find peaks in a 3D image</span></h3>
<pre class="brush:python">
# @ImagePlus imp

from fiji.plugin.trackmate.detection import DogDetector
from ij.gui import PointRoi
from ij.plugin.frame import RoiManager
from net.imglib2.img.display.imagej import ImageJFunctions

# Set the parameters for DogDetector
img = ImageJFunctions.wrap(imp)
interval = img
cal = imp.getCalibration()
calibration = [cal.pixelWidth, cal.pixelHeight, cal.pixelDepth]
radius = 0.2 # the radius is half the diameter
threshold = 100
doSubpixel = True
doMedian = False

# Setup spot detector
# (see http://javadoc.imagej.net/Fiji/fiji/plugin/trackmate/detection/DogDetector.html)
# 
# public DogDetector(RandomAccessible&lt;T&gt; img,
#            Interval interval,
#            double[] calibration,
#            double radius,
#            double threshold,
#            boolean doSubPixelLocalization,
#            boolean doMedianFilter)
detector = DogDetector(img, interval, calibration, radius, threshold, doSubpixel, doMedian)

# Start processing and display the results
if detector.process():
    # Get the list of peaks found
    peaks = detector.getResult()
    print str(len(peaks)), "peaks were found."

    # Add points to ROI manager
    rm = RoiManager.getInstance()
    if not rm:
        rm = RoiManager()

    # Loop through all the peak that were found
    for peak in peaks:
        # Print the current coordinates
        print peak.getDoublePosition(0), peak.getDoublePosition(1), peak.getDoublePosition(2)
        # Add the current peak to the Roi manager
        proi = PointRoi(peak.getDoublePosition(0) / cal.pixelWidth, peak.getDoublePosition(1) / cal.pixelHeight)
        proi.setPosition(int(peak.getDoublePosition(2) / cal.pixelDepth))
        rm.addRoi(proi)

    # Show all ROIs on the image
    rm.runCommand(imp, "Show All")

else:
    print "The detector could not process the data."
</pre>
<h2><span class="mw-headline" id="Tips_and_Tricks">Tips and Tricks</span></h2>
<h3><span class="mw-headline" id="Getting_a_list_of_all_members_in_one_package">Getting a list of all members in one package</span></h3>
<p>You can use the Python function <i>dir(&lt;package&gt;)</i> to see the contents of a package:
</p>
<pre class="brush:python">
import ij
print dir(ij)
</pre>
<p><b>Note:</b> As of April 26nd, 2010, you need to start Fiji with
</p>
<pre>fiji -Dpython.cachedir.skip=false --
</pre>
<p>for <i>dir(&lt;package&gt;)</i> to work.
</p>
<h3><span class="mw-headline" id="Specifying_the_encoding_of_the_source">Specifying the encoding of the source</span></h3>
<p>When your source code contains non-ASCII characters (such as umlauts), Jython will complain with a <i>SyntaxError: Non-ASCII character in file '&lt;iostream&gt;', but no encoding declared</i>.
</p><p>You can fix this issue by putting the line
</p>
<pre># -*- coding: iso-8859-15 -*-
</pre>
<p>as first line into your source code (or if it starts with <i>#!/usr/bin/python</i>, as second line), as suggested <a rel="nofollow" class="external text" href="http://docs.python.org/tutorial/interpreter.html#source-code-encoding">here</a>. You might need to replace the string <i>iso-8859-15</i> by something like <i>utf-8</i> if your source code is encoded in UTF-8.
</p>
<h3><span class="mw-headline" id="Changing_the_default_encoding">Changing the default encoding</span></h3>
<p>By default, Jython encodes the standard output (and other streams) with the ASCII encoding. Often, this is not what you want. You can change the default encoding like this:
</p>
<pre class="brush:python">
from org.python.core import codecs
codecs.setDefaultEncoding('utf-8')
</pre>
<h3><span class="mw-headline" id="Error_handling_with_try_.2F_except_.2F_finally">Error handling with try / except / finally</span></h3>
<p>See complete documentation at: <a rel="nofollow" class="external text" href="http://jythonpodcast.hostjava.net/jythonbook/chapter6.html">jython book chapter 6</a>.
</p>
<pre class="brush:python">
x = 10
y = 0

try:
     z = x / y
except NameError, e1:
     print "A variable is not defined!", e1
except ZeroDivisionError, e2:
     print "Dividing by zero doesn't make any sense! Error:", e2
finally:
     print "This line will always print no matter what error occurs."
</pre>
<p>Which prints:
</p>
<pre>Dividing by zero doesn't make any sense! Error: integer division or modulo by zero
This line will always print no matter what errors occurs
</pre>
<p>To catch any kind of errors, use <i>sys.exc_info</i>:
</p>
<pre class="brush:python">
import sys

try:
  z = x / z
except:
  print "Error: ", sys.exc_info()
</pre>
<p>Which prints:
</p>
<pre>Error:  (&lt;type 'exceptions.NameError'&gt;, NameError("name 'x' is not defined",), &lt;traceback object at 0x2&gt;)
</pre>
<p><br />
To ensure that you see the stack trace, print it to the ImageJ log window instead of stdout (whathever the latter may be):
</p>
<pre class="brush:python">
    IJ.log(str(sys.exc_info()))
</pre>
<h3><span class="mw-headline" id="Importing_other_.py_scripts_.28modules.29">Importing other <i>.py</i> scripts (modules)</span></h3>
<p>If you want to import other python files, you need to <i>import</i> them. This requires that the files are found in the so-called <i>search path</i>, a list of directories in which Jython looks for the modules (<i>.py</i> files) to import. You can easily extend the search path:
</p>
<pre class="brush:python">
from sys import path
from java.lang.System import getProperty

# extend the search path by $FIJI_ROOT/bin/
path.append(getProperty('fiji.dir') + '/bin')

# Now you can import $FIJI_ROOT/bin/compat.py
import compat
</pre>
<p>A situation you are likely to encounter is when you have multiple jython scripts in a folder under the fiji plugins folder.
</p><p>For example, suppose you have the folder <i>my scripts</i> under the fiji <i>plugins</i> folder, in which you have the script <i>Filters.py</i> with the following filter functions in it:
</p>
<pre class="brush:python">
# Script plugins/my scripts/Filters.py
from ij import IJ
from ij.plugin import Duplicator

def median(imp, radius):
  """ Apply a median filter to a copy
      of the given ImagePlus, and return it. """
  copy = Duplicator().run(imp)
  IJ.run(copy, "Median...", "radius=" + str(radius))
  return copy

def removeOutliers(imp, radius, threshold, bright):
  """ Apply a remove outliers filter to a copy
      of the given ImagePlus, and return it. """
  copy = Duplicator().run(imp)
  which = "Bright" if bright else "Dark"
  IJ.run(copy, "Remove Outliers...", "radius=" + str(radius) \
      + " threshold=" + str(threshold) + " which=" + which)
  return copy
</pre>
<p>And now you have a second script in which you want to use a function from the <i>Filters.py</i> script:
</p>
<pre class="brush:python">
from ij import IJ
import sys
from java.lang.System import getProperty
sys.path.append(getProperty("fiji.dir") + "/plugins/my scripts")
from Filters import median

imp = IJ.getImage()
medianFiltered = median(imp, 5.0)
medianFiltered.show()
</pre>
<h3><span class="mw-headline" id="Defining_a_class_and_creating_instances_of_the_new_class">Defining a class and creating instances of the new class</span></h3>
<p>A simple class to store an X,Y coordinate. (In real code, just use javax.vecmath.* classes such as Point3f, Point3d, etc.)
</p><p>The constructor is defined with <i>__init__</i>, and takes at least one argument , named <i>self</i> by convention (you may name it something else, like <i>this</i>).
</p>
<pre class="brush:python">
from math import sqrt, pow

class Point:
  def __init__(self, x, y):
    self.x = x
    self.y = y
  def distance(self, other):
    return sqrt(pow(self.x - other.x, 2), pow(self.y - other.y, 2))
</pre>
<p>... and create two instances, and measure the distance between them. To create the new instances, we use the name of the class with the arguments in brackets:
</p>
<pre class="brush:python">
p1 = Point(10, 20)
p2 = Point(40, 55.3)

print "Distance:", p1.distance(p2)
</pre>
<h3><span class="mw-headline" id="Adding_a_static_method_to_a_class">Adding a static method to a class</span></h3>
<p>A static method is a method of a class that doesn't need a <i>self</i> first argument. You may call this method by using the name of the class alone--you don't need to invoke it on an instance.
</p><p>To declare a method as static, decorate it with <i>@staticmethod</i>, as shown below for method <i>two</i>:
</p>
<pre class="brush:python">
class Numbers:

  def one(self):
    return 1

  @staticmethod
  def two():
    return 2
</pre>
<p>Now, to invoke these methods, notice how <i>two</i> doesn't need to be invoked on an instance (we merely prepend the class name), but <i>one</i> does:
</p>
<pre class="brush:python">
print Numbers.two()

that = Numbers()
print that.one()
</pre>
<p>Why would you want to use a static method? It is useful to keep the namespace tidy, to avoid name collisions.
</p>
<h3><span class="mw-headline" id="Creating_multi-dimensional_native_java_arrays">Creating multi-dimensional native java arrays</span></h3>
<p>Suppose you want to create a one-dimensional double array, the equivalent of <b>double[]</b> in java. This is what you would do:
</p>
<pre class="brush:python">
from jarray import array

data = [1.0, 2.0, 3.0, 4.0]

arr = array(data, 'd')
</pre>
<p>Other accepted primitive array types are:
</p>
<pre>z	boolean
c	char
b	byte
h	short
i	int
l	long
f	float
d	double
</pre>
<p>But now suppose you want a two-dimensional double array, the equivalent of <b>double[][]</b> in java. How to do that? Here's how:
</p>
<pre class="brush:python">
from jarray    import array
from java.lang import Class

data = [[1.0, 2.0], [3.0, 4.0]]
twoDimArr = array(data, Class.forName('[D'))
</pre>
<p>Essentially, what we did is to give the function <b>array</b> the argument <b>class of a one-dimensional double array</b>, so that it will create an array of that--hence a two-dimensional double array.
</p><p>For a three-dimensional array in jython, you'd just add another <b>[</b> (square bracket) to the class name:
</p>
<pre class="brush:python">
from jarray import array
from java.lang import Class

data = [[[1, 2, 3], [4, 5, 6]], [[1, 2, 3], [4, 5, 6]]]
threeDimArr = array(data, Class.forName('[[D'))
</pre>
<p>See the <a rel="nofollow" class="external text" href="http://www.jython.org/archive/21/docs/jarray.html">jarray documentation</a>.
</p><p>To create primitive arrays of any class, pass along the class itself. For example, a native array of <b>String</b>:
</p>
<pre class="brush:python">
from jarray import array

texts = ["one", "two", "three"]

strings = array(texts, String)
</pre>
<p>Of course arrays can also be created empty. For numbers, all values will be zero. For an arbitrary class such as <b>String</b>, all values will be null (or None, in python parlance).
</p><p>In the example below, we create an empty two-dimensional array of <b>double[N][]</b> type, where the smaller, inner arrays are null (just like in java a <b>new double[5][]</b> would have the second-order also all null):
</p>
<pre class="brush:python">
from jarray import zeros

twoDimArr = zeros(5, Class.forName("[D"))

print twoDimArr
# prints: array([D, [None, None, None, None, None])

# fill each slot with a new array of length 3:
for i in range(len(twoDimArr)):
  twoDimArr[i] = zeros(3, 'd')

print twoDimArr
#prints: array([D, [array('d', [0.0, 0.0, 0.0]), array('d', [0.0, 0.0, 0.0]),
# array('d', [0.0, 0.0, 0.0]), array('d', [0.0, 0.0, 0.0]), array('d', [0.0, 0.0, 0.0])])
</pre>
<h3><span class="mw-headline" id="Inline_java_code_inside_jython:_the_Weaver">Inline java code inside jython: the Weaver</span></h3>
<p>Jython is great at doing high-level operations on images. But sometimes one wants to edit pixels specifically. The performance of low-level loops in jython are far from the performance offered by java. But writing a special-purpose java class for a minor piece of code is painful and requires specific java skills regarding code compilation and classpath management.
</p><p>The weaver removes all the pain.
</p><p>The weaver offers two ways to embed java code: the <i>inline</i> and the <i>method</i>.
</p><p>Here is an example using the <i>inline</i> approach, where the <i>float[]</i> pixels array of the current image is iterated to compute the mean intensity:
</p>
<pre class="brush:python">
from fiji.scripting import Weaver
from ij import IJ
from java.lang import Double

# The currently open image
imp = IJ.getImage()

fp = imp.getProcessor().convertToFloat()
pixels = fp.getPixels()  # a float array, float[]

# Three arguments:
# 1. The java code to embed.
# 2. The dictionary of bindings, where the key is the name to use within the java code, and the value is the object to bind to it.
# 3. The return type (optional; defaults to java.lang.Object).

w = Weaver.inline(
    """
    double sum = 0;
    for (int i=0; i&lt;pixels.length; i++) {
        sum += pixels[i];
    }
    return sum / pixels.length;
    """,
    {"pixels"&#160;: pixels}, Double)

mean = w.call()

print mean
</pre>
<p>The above is trivial and it is meant only as an example (there are better ways to get the mean value, such as via <i>imp.getStatistics()</i>. Notice that the <i>Weaver.inline</i> function takes three arguments: the java code to inline, the map of bindings, and the return type. In the example, we pass only the <i>float[]</i> pixels array, and define <i>Double</i> as the return type. The return type is optional.
</p><p>Internally, bindings are represented as fields in a java class, set as either primitives (like double, int ...) or the least general public class or superclass of the object to bind.
</p><p>A better example that exploits the capabilities of the <i>Weaver.inline</i> is the following: compile the function once, and then call it over and over with different parameters. The bindings cannot be changed, but if they are arrays or collections, one can change the elements of these collections. For example, to obtain a new <i>ImageStack</i> that is the result of applying XOR to each consecutive pair of slices (which will give you the boundaries of objects):
</p>
<pre class="brush:python">
from ij import IJ, ImagePlus, ImageStack
from fiji.scripting import Weaver

# The currently open image, an 8-bit stack
imp = IJ.openImage("https://imagej.net/images/bat-cochlea-volume.zip")

slices = [None, None]

w = Weaver.inline(
    """
    byte[] pix1 = (byte[]) slices.get(0);
    byte[] pix2 = (byte[]) slices.get(1);

    byte[] xor = new byte[pix1.length];
    for (int i=0; i&lt;pix1.length; i++) {
        xor[i] = (byte)(pix1[i] ^ pix2[i]);
    }
    return xor;
    """,
    {"slices"&#160;: slices})

stack = imp.getStack()
stackXOR = ImageStack(stack.width, stack.height)

for i in range(2, imp.getNSlices()+1):
  # Put the pixel arrays into the pre-made list
  slices[0] = stack.getPixels(i-1)
  slices[1] = stack.getPixels(i)
  # Invoke native code
  stackXOR.addSlice( str(i-1), w.call() )

ImagePlus("XORed stack", stackXOR).show()
</pre>
<p><br />
The above approach with <i>Weaver.inline</i> becomes a bit verbose and ad-hoc, having to edit the contents of the <i>slices</i> list.
</p><p>Instead, here is the same code but using the <i>Weaver.method</i> approach, where, instead of bindings, we pass the arrays directly as method arguments. This approach requires knowing a bit more about java, but not much, to declare a full java class method (or any number of them). The returned <i>w</i> object contains that method, which we can invoke with, in this case, the two byte arrays as arguments:
</p>
<pre class="brush:python">
from ij import IJ, ImagePlus, ImageStack
from fiji.scripting import Weaver

# The currently open image, an 8-bit stack
imp = IJ.openImage("https://imagej.net/images/bat-cochlea-volume.zip")

w = Weaver.method(
  """
  public byte[] xor(byte[] pix1, byte[] pix2) {
    byte[] xor = new byte[pix1.length];
    for (int i=0; i&lt;pix1.length; i++) {
        xor[i] = (byte)(pix1[i] ^ pix2[i]);
    }
    return xor;
  }
  """)

stack = imp.getStack()
stackXOR = ImageStack(stack.width, stack.height)

for i in range(2, imp.getNSlices()+1):
  # Invoke native code
  stackXOR.addSlice( str(i-1), w.xor(stack.getPixels(i-1), stack.getPixels(i)) )

ImagePlus("XORed stack", stackXOR).show()
</pre>
<p><br />
There are two additional, optional arguments for <i>Weaver.inline</i> and <i>Weaver.method</i>:
</p>
<pre>1. A list of classes to insert as imports, so that instead of fully qualified class names
</pre>
<pre class="brush:java">
  ij.process.FloatProcessor ip = new ij.process.FloatProcessor(100, 100)
</pre>
<p>... one can write the much briefer:
</p>
<pre class="brush:java">
  FloatProcessor ip = new FloatProcessor(100, 100)
</pre>
<pre>2. A boolean, to show the generated java code in a tab of the Script Editor.
</pre>
<p>Here is a small example, using <i>Weaver.method</i>, that uses imports. The script subtracts "10" from every pixel:
</p>
<pre class="brush:python">
from net.imglib2.type.numeric.real import FloatType
from net.imglib2.img.display.imagej import ImageJFunctions as IJF
from fiji.scripting import Weaver
from ij import IJ
from net.imglib2 import Cursor, IterableInterval
from net.imglib2.type.numeric.real import FloatType

# Grab a 32-bit image
imp = IJ.getImage()

# View it as an ImgLib2 image
img = IJF.wrap(imp)

# Declare a java method to subtract a value from every pixel
w = Weaver.method(
  """
  public void subtract(final IterableInterval&lt;FloatType&gt; img, final float value) {
    final FloatType v = new FloatType(-value);
    final Cursor&lt;FloatType&gt; cursor = img.cursor();
    while (cursor.hasNext()) {
      cursor.fwd();
      cursor.get().add(v);
    }
  }
  """,
  [IterableInterval, Cursor, FloatType])

w.subtract(img, 10)

imp.updateAndDraw()
</pre>
<p><br />
Of course the Weaver is a java library, and may be used from any scripting language such as <a href="Javascript_Scripting" class="mw-redirect" title="Javascript Scripting">Javascript</a>, <a href="JRuby_Scripting" title="JRuby Scripting">JRuby</a>, and <a href="./Category:Scripting" title="Category:Scripting">others</a>.
</p><p>All the above is inspired by the <a rel="nofollow" class="external text" href="http://www.scipy.org/Cookbook/Weave">Scientific Python Weaver, or scipy Weaver</a>, which inlines C code inside a python file.
</p>
<h3><span class="mw-headline" id="Reading_command_line_arguments_given_to_a_script">Reading command line arguments given to a script</span></h3>
<p>The Fiji launcher can execute scripts. When running scripts from the command line with the launcher, it is convenient to read out the arguments given to the script. For example, suppose you create a script to open an image file and do some processing with it, and you want to read the name of the file to open from the command line argument. Here is how:
</p>
<pre class="brush:python">
import os, sys
from ij import IJ

# Expecting one argument: the file path
if len(sys.argv) &lt; 2:
  print "Usage: ./fiji-linux64 &lt;script-name&gt; &lt;file-path&gt;"
  sys.exit(1)

filepath = sys.argv[1]

# Check if the file exists
if not os.path.exists(filepath):
  print "File does not exist at path:", filepath
  sys.exit(1)

# Open the image
imp = IJ.openImage(filepath)
print "Processing:", imp.title

# Do some processing ...

</pre>
<p>IMPORTANT: notice that, when executing scripts from the command line, there is no auto-importing of common imports. So above we <b>must</b> declare "from ij import IJ" to import the namespace <i>IJ</i> with all the static utility functions such as <i>openImage</i>.
</p>
<h3><span class="mw-headline" id="Catching_errors_from_a_running_macro">Catching errors from a running macro</span></h3>
<p>ImageJ exits with zero even when it fails (see <a rel="nofollow" class="external text" href="https://github.com/imagej/imagej/issues/61">bug report</a>). A possible fix is to convert the macro into a plugin but a quicker fix, is to wrap the macro call into a script. For this purpose, it is enough to check the returned string of <code>runMacroCode</code>, which will return the string <code>[aborted]</code> in case of <a rel="nofollow" class="external text" href="http://jenkins.imagej.net/job/ImageJ1-javadoc/javadoc/ij/plugin/Macro_Runner.html#runMacro%28java.lang.String,%20java.lang.String%29">failure</a>:
</p>
<pre class="brush:python">
from ij import IJ
import sys
 
if not len (sys.argv) &gt; 1:
  raise TypeError ("No macro file argument")
 
status = IJ.runMacroFile(sys.argv[1])
if status == '[aborted]':
  raise StandardError ("Macro execution failed")

sys.exit (0)
</pre>
<p>Of course, if your macro happens to return <code>[aborted]</code> for success, you're out of luck&#160;;)
</p>
<h3><span class="mw-headline" id="Running_3rd_party_java_libraries">Running 3rd party java libraries</span></h3>
<p>It is possible to run external java programs within Jython. To make them available, just copy the corresponding jar file into Fiji's plugins folder. To import the respective java classes, just do
</p>
<pre class="brush:python">
import name.of.external.java.library as foo
</pre> 
<p>If the class names of the external package are unknown, one possibility is to inspect the jar file manually. On Linux and Mac OS systems just do on the command line
</p>
<pre class="brush:plain">

jar tvf &lt;library&gt;.jar 

</pre>
<p>This will print the jar contents as plain text, look for entries ending with ".class". For the implementation of json in jython, provided at jyson.xhaus.com, the output looks like:
</p>
<pre class="brush:plain">

jar tvf jyson-1.0.2.jar
     0 Sat Mar 17 14:06:40 CET 2012 META-INF/
   106 Sat Mar 17 14:06:38 CET 2012 META-INF/MANIFEST.MF
     0 Sat Mar 17 14:06:40 CET 2012 com/
     0 Sat Mar 17 14:06:40 CET 2012 com/xhaus/
     0 Sat Mar 17 14:06:40 CET 2012 com/xhaus/jyson/
   174 Sat Mar 17 14:06:40 CET 2012 com/xhaus/jyson/JSONDecodeError.class
   174 Sat Mar 17 14:06:40 CET 2012 com/xhaus/jyson/JSONEncodeError.class
   162 Sat Mar 17 14:06:40 CET 2012 com/xhaus/jyson/JSONError.class
  1650 Sat Mar 17 14:06:40 CET 2012 com/xhaus/jyson/JysonCodec.class
  6350 Sat Mar 17 14:06:40 CET 2012 com/xhaus/jyson/JysonDecoder.class
  3899 Sat Mar 17 14:06:40 CET 2012 com/xhaus/jyson/JysonEncoder.class
</pre>
<p>The JysonCodec.class is the toplevel class, so to import this library include the following line in your jython script:
</p>
<pre class="brush:python">
import com.xhaus.jyson.JysonCodec as jyson
</pre>
<h2><span class="mw-headline" id="Jython_for_plugins">Jython for plugins</span></h2>
<h3><span class="mw-headline" id="Using_a_jython_script_as_a_plugin">Using a jython script as a plugin</span></h3>
<p>The simplest way is to place the jython script file into fiji/plugins/ folder or a subfolder, and it will appear in the menus after running "'<span><em><span style="border-bottom:1px dotted #ccc;"> Plugins </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> Scripting </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> Refresh Jython Scripts</span></em></span>'" or "'<span><em><span style="border-bottom:1px dotted #ccc;"> Help </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> Refresh Menus</span></em></span>'", or on restarting Fiji.
</p><p>If you want to have the Jython script show up in a place outside the Plugins menu, just put the file into an appropriate subdirectory of fiji/plugins/Scripts/; for example, if you put a Jython script called Animation_.py into fiji/plugins/Scripts/File/New/, it will be available as <span><em><span style="border-bottom:1px dotted #ccc;"> File </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> New </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> Animation</span></em></span>.
</p><p>To populate an update site, the updater let the possibility to directly upload jython scripts as .py (or $py.class for the one that resides in the <code>Jars/Lib</code> folder).  
Alternatively if you want to bundle multiple scripts you can pack them into a jar archive as described below.
</p>
<h3><span class="mw-headline" id="Distributing_jython_scripts_in_a_.jar_file">Distributing jython scripts in a .jar file</span></h3>
<p>PLEASE NOTE: there is no need to do the following -- unless you want to bundle a couple of scripts in one package. See entry above.
</p><p>The whole idea is to be able to distribute an entire collection of scripts in a single .jar file, for best convenience.
</p><p>In this example, we create two jython scripts that we want to distribute in a .jar file as plugins:
</p><p>The <i>printer.py</i> script:
</p>
<pre class="brush:python">
IJ.log("Print this to the log window")
</pre>
<p>... and the <i>create_new_image.py</i> script:
</p>
<pre class="brush:python">
ip = ByteProcessor(400, 400)
imp = ImagePlus("New", ip)
ip.setRoi(OvalRoi(100, 100, 200, 200))
ip.setValue(255)
ip.fill(ip.getMask())
imp.show()
</pre>
<h4><span class="mw-headline" id="Manual_packaging">Manual packaging</span></h4>
<p>Place both scripts under a folder named <i>scripts/</i> .
</p><p>You will need a tiny .java file specifying a launcher PlugIn, such as:
</p>
<pre class="brush:java">
package my;
import ij.plugin.PlugIn;
import Jython.Refresh_Jython_Scripts;

public class Jython_Launcher implements PlugIn {
    public void run(String arg) {
        new Refresh_Jython_Scripts().runScript(getClass().getResourceAsStream(arg));
    }
}
</pre>
<p>Notice we place the above file under directory <i>my/</i>, packaged.
</p><p>To compile it:
</p>
<pre>$ javac -classpath .:ij.jar:../jars/fiji-scripting.jar:../plugins/Jython_Interpreter.jar my/Jython_Launcher.java 
</pre>
<p>(check that the path to the three jars that you need is correct!)
</p><p><br />
Then we define the plugins.config file:
</p>
<pre>Plugins&gt;My Scripts, "Print to log window", my.Jython_Launcher("/scripts/printer.py")
Plugins&gt;My Scripts, "Create image with a white circle", my.Jython_Launcher("/scripts/create_new_image.py")
</pre>
<p>Finally, we put all files in a .jar file:
</p>
<pre>$ jar cf my_jython_scripts.jar plugins.config my/Jython_Launcher.class scripts/*py
</pre>
<p>Then, drop the jar file into fiji/plugins/ folder and run "Help - Update Menus", or restart fiji. Your scripts will appear under Plugins - My Scripts.
</p><p>For clarity, this is a summary of the files in the folder:
</p>
<pre>my/Jython_Launcher.java
my/Jython_Launcher.class
scripts/printer.py
scripts/create_new_image.py
plugins.config
</pre>
<h4><span class="mw-headline" id="With_Maven">With Maven</span></h4>
<p>Even if you are not familiar with Maven, packaging the py script into a jar is rather straightforward.  
</p><p>First make sure that you have installed Maven and a java jdk and add the path to those 2 in your environment variables (see <a rel="nofollow" class="external text" href="https://maven.apache.org/install.html">Maven installation</a>). 
</p><p>Then download a zip of this <a rel="nofollow" class="external text" href="https://github.com/m-entrup/imagej-jython-package">Github repository</a>. And follow the guidelines&#160;: 
</p>
<ul><li> place your script in a subfolder of <code>Ressources</code></li>
<li> eventually modify the pom file according to your dependencies (see <a rel="nofollow" class="external text" href="Building_a_POM">Building a POM</a> </li>
<li> then open a command line in the folder and type <code>mvn package</code>.    </li></ul>
<p>Eventually you can also type <code>mvn -Dimagej.app.directory=/path/to/your/Fiji.app -Dimagej.deleteOtherVersions=older</code> to have the dependencies automatically coped to an ImageJ installation&#160;: handy to test your package on a fresh installation.   
</p><p>NB&#160;: This latter command with the dependencies was <a rel="nofollow" class="external text" href="http://forum.imagej.net/t/use-opencv-within-jython-macro/10320/18?u=lthomas">reported not to function with windows Powershell</a>, although the normal packaging works. Use a different command line tool in this case.
</p><p>Notice, though, that <b>you don't need to do the .jar packaging at all</b>. Just place the python scripts directly under fiji/plugins/My Scripts/ and they will appear in the menus as regular plugins, and similarly be handle by the updater to populate an update site.
</p>
<h1><span class="mw-headline" id="Jython_examples_in_Fiji">Jython examples in Fiji</span></h1>
<ul><li><a rel="nofollow" class="external text" href="https://github.com/fiji/fiji/blob/master/plugins/Examples/Find_Dimension_of_Raw_Image.py">Find Dimension of Raw Image</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/fiji/fiji/blob/master/plugins/Examples/Edit_LUT_As_Text.py">Edit LUT As Text</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/fiji/fiji/blob/master/plugins/Examples/Delayed_Snapshot.py">Delayed Snapshot</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/fiji/fiji/blob/master/plugins/Examples/Command_Launchers/Command_Launcher_Python.py">Command Launcher GUI</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/fiji/fiji/blob/master/plugins/Examples/list_all_threads.py">List all threads</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/fiji/fiji/blob/master/plugins/Examples/chess_.py">Chess</a></li></ul>
<ul><li><a rel="nofollow" class="external text" href="https://github.com/fiji/fiji/blob/master/plugins/Examples/TrakEM2_Example_Scripts/extract_stack_under_arealist.py">Extract stack under AreaList</a> in TrakEM2.</li>
<li><a rel="nofollow" class="external text" href="https://github.com/fiji/fiji/blob/master/plugins/Examples/TrakEM2_Example_Scripts/T2_set_all_transforms_to_identity.py">Set all transforms to identity</a> for TrakEM2 objects.</li>
<li><a rel="nofollow" class="external text" href="https://github.com/fiji/fiji/blob/master/plugins/Examples/TrakEM2_Example_Scripts/T2_Select_All.py">Select All</a> objects in TrakEM2.</li>
<li><a rel="nofollow" class="external text" href="https://github.com/fiji/fiji/blob/master/plugins/Examples/TrakEM2_Example_Scripts/Measure_AreaLists.py">Measure AreaList</a> in TrakEM2.</li></ul>
<h1><span class="mw-headline" id="See_also">See also</span></h1>
<ul><li>Albert Cardona's crash course in <a rel="nofollow" class="external text" href="http://www.ini.uzh.ch/~acardona/fiji-tutorial/index.html">Jython scripting with Fiji</a>. </li>
<li>Jython for <a href="TrakEM2_Scripting" title="TrakEM2 Scripting">TrakEM2 Scripting</a>.</li></ul>

<!-- 
NewPP limit report
Cached time: 20200713072810
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.184 seconds
Real time usage: 0.185 seconds
Preprocessor visited node count: 3562/1000000
Preprocessor generated node count: 13624/1000000
Postexpand include size: 29111/2097152 bytes
Template argument size: 11279/2097152 bytes
Highest expansion depth: 9/40
Expensive parser function count: 0/3
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%  115.239      1 - -total
 38.81%   44.730      2 - Template:Key
 34.40%   39.638      3 - Template:Key_press/core
 15.56%   17.928      8 - Template:Bc
 12.41%   14.303      1 - Template:Learn
 10.97%   12.636      1 - Template:Menu
  9.75%   11.234      4 - Template:Submenu
  8.81%   10.155      1 - Template:Person
  6.75%    7.780     11 - Template:GitHub
  6.03%    6.950      3 - Template:Ambox
-->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="index.php?title=Jython_Scripting_Examples&amp;oldid=41272">http://imagej.net/index.php?title=Jython_Scripting_Examples&amp;oldid=41272</a>"</div>
							</div>

			<div id="footer">
				<p> This page was last modified on 24 January 2020, at 11:54.</p><ul><li><a href="./ImageJ:Privacy_policy" title="ImageJ:Privacy policy">Privacy policy</a></li><li><a href="./ImageJ:About" class="mw-redirect" title="ImageJ:About">About ImageJ</a></li><li><a href="Imprint" title="Imprint">Imprint</a></li></ul>			</div>

			<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="./Special:Categories" title="Special:Categories">Categories</a>: <ul><li><a href="./Category:Scripting" title="Category:Scripting">Scripting</a></li><li><a href="./Category:Jython" title="Category:Jython">Jython</a></li></ul></div></div>		</div>

		<div id="bottom-wrap">
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.loader.load(["ext.fancytree","ext.suckerfish","mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","ext.SimpleTooltip"]);});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":385});});</script>
		</body>
		</html>
		