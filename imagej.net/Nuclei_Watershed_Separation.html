<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>Nuclei Watershed Separation - ImageJ</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Nuclei_Watershed_Separation","wgTitle":"Nuclei Watershed Separation","wgCurRevisionId":41299,"wgRevisionId":41299,"wgArticleId":494,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Tutorials","Segmentation"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Nuclei_Watershed_Separation","wgRelevantArticleId":494,"wgRequestId":"59e17f27a961d37ce9aff251","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgPreferredVariant":"en","fancytree_path":"/extensions/TreeAndMenu/fancytree"});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user.cssprefs":"ready","user":"ready","user.options":"loading","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","skins.erudite":"ready"});mw.loader.implement("user.options@0j3lz3q",function($,jQuery,require,module){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens@1ku9xth",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["mediawiki.page.startup"]);});</script>
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%252Cshared%257Cmediawiki.sectionAnchor%257Cskins.erudite&amp;only=styles&amp;skin=erudite.css"/>
<script async="" src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=erudite"></script>
<link rel="stylesheet" href="extensions/TreeAndMenu/fancytree/fancytree.css"/><link rel="stylesheet" href="extensions/TreeAndMenu/suckerfish/suckerfish.css"/>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=erudite.css"/>
<meta name="generator" content="MediaWiki 1.28.0"/>
<meta name="description" content="documentation for analyze particles."/>
<link rel="shortcut icon" href="skins/ij2.ico"/>
	<meta property="og:type" content="article"/>

	<meta property="og:site_name" content="ImageJ"/>

	<meta property="og:title" content="Nuclei Watershed Separation"/>

	<meta property="og:description" content="documentation for analyze particles."/>


<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Nuclei_Watershed_Separation rootpage-Nuclei_Watershed_Separation skin-erudite action-view">
		<div class="mw-jump">
			<a href="Nuclei_Watershed_Separation.html#bodyContent">Skip to content</a>, 			<a href="Nuclei_Watershed_Separation.html#search">Skip to search</a>
		</div>

		<div id="top-wrap" role="banner">
			<h1><a href="Welcome" title="ImageJ" rel="home">ImageJ</a></h1>
			<div id="tagline">From ImageJ</div>

			<a id="menubutton" href="Nuclei_Watershed_Separation.html#menu">Menu</a>
			<div id="nav" role="navigation">
			<ul id='menu'>
<li id="menu-item-n-About"><a href="ImageJ">About</a></li>
<li id="menu-item-n-Downloads"><a href="Downloads">Downloads</a></li>
<li id="menu-item-n-Learn"><a href="Learn">Learn</a></li>
<li id="menu-item-n-Develop"><a href="Development">Develop</a></li>
<li id="menu-item-n-News"><a href="News">News</a></li>
<li id="menu-item-n-Events"><a href="Events">Events</a></li>
<li id="menu-item-n-Help"><a href="Help">Help</a></li>
</ul>
			</div>
		</div>

		<div id="mw-js-message"></div>
		
		<div id="main" role="main">
			<div id="nav-meta">
			<span id="ca-nstab-main" class="selected"><a href="Nuclei_Watershed_Separation" title="View the content page [c]" accesskey="c">Page</a></span><span class="meta-sep">|</span><span id="ca-talk"><a href="Talk:Nuclei_Watershed_Separation" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></span><span class="meta-sep">|</span><span id="ca-viewsource"><a href="index.php?title=Nuclei_Watershed_Separation&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span><span class="meta-sep">|</span><span id="ca-history"><a href="index.php?title=Nuclei_Watershed_Separation&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></span><span class="meta-sep">|</span>			</div>

			<div id="bodyContent">
				<h1>Nuclei Watershed Separation</h1>
				
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Nuclei_Watershed_Separation.html#Watershed_Separation_of_touching_DAPI_stained_nuclei_images_-Tutorial"><span class="tocnumber">1</span> <span class="toctext">Watershed Separation of touching DAPI stained nuclei images -Tutorial</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="Nuclei_Watershed_Separation.html#Introduction_to_the_problem"><span class="tocnumber">1.1</span> <span class="toctext">Introduction to the problem</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="Nuclei_Watershed_Separation.html#Open_the_sample_image"><span class="tocnumber">1.2</span> <span class="toctext">Open the sample image</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="Nuclei_Watershed_Separation.html#Pixel_Intensity_Threshold_-_find_the_foreground_areas"><span class="tocnumber">1.3</span> <span class="toctext">Pixel Intensity Threshold  - find the foreground areas</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="Nuclei_Watershed_Separation.html#Watershed_algorithm_-_separate_touching_objects"><span class="tocnumber">1.4</span> <span class="toctext">Watershed algorithm - separate touching objects</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="Nuclei_Watershed_Separation.html#Analyze_the_segmented_objects"><span class="tocnumber">1.5</span> <span class="toctext">Analyze the segmented objects</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Watershed_Separation_of_touching_DAPI_stained_nuclei_images_-Tutorial">Watershed Separation of touching DAPI stained nuclei images -Tutorial</span></h2>
<h3><span class="mw-headline" id="Introduction_to_the_problem">Introduction to the problem</span></h3>
<ul><li> A very common biological sample for microscopy is DAPI stained DNA in cell nuclei. The staining delineates the nuclei pretty well,  since in a metaphase cell there is DNA all over the nucleus. however, the staining is not homogenous, as there are areas of more or less condensation of the chromosomes. This makes the nuclei appear granular. Worse still, in many tissues that are interesting for developmental biology, the cells are tightly packed, and are composed mostly of nucleus with very little cytoplasm separating them. The nuclei often seem to touch each other, which in reality, of course, they can not. There is a membrane or two at least between them,  but an optical microscope cannot resolve that. The <a href="http://en.wikipedia.org/wiki/Point_spread_function" class="extiw" title="wikipedia:Point spread function">PSF</a> is much bigger than the width of a membrane! Just to make matters even worse the image is quite noisy, because it was made with a fast scan on a confocal laser scanning microscope,  which inherently has a low signal/noise ratio. That gives objects fuzzy edges and adds uncertainty to the intensity values of each pixel,  making it harder to segment properly. </li></ul>
<ul><li> So, we are faced with the problem of being able to separate apparently touching, noisy, objects&#160;:-(</li></ul>
<ul><li> Luckily, there is a method for doing exactly that. The Watershed method. </li></ul>
<ul><li> Okay, so how can we denoise, segment, watershed (separate touching objects) and then count / measure the objects in Fiji? Read on...</li></ul>
<h3><span class="mw-headline" id="Open_the_sample_image">Open the sample image</span></h3>
<ul><li> open the <a href="_images/8/83/NucleiDAPIconfocal.png" class="internal" title="NucleiDAPIconfocal.png">sample image of touching DAPI stained cell nuclei from a confocal laser scanning microscope.</a></li></ul>
<p><a href="File:NucleiDAPIconfocal.png" class="image"><img alt="NucleiDAPIconfocal.png" src="_images/8/83/NucleiDAPIconfocal.png" width="250" height="259" /></a>
</p>
<ul><li> Run a <a rel="nofollow" class="external text" href="http://imagejdocu.tudor.lu/doku.php?id=gui:process:filters">Gaussian Blur filter</a> on the image to blur out the "speckle", actually Poisson distributed, statistical "photon <a href="http://en.wikipedia.org/wiki/Shot_noise" class="extiw" title="wikipedia:Shot noise">shot noise</a>", and also to smooth out the inhomogeneity of the nuclear staining. We will use a large sigma value of 3 for this task.  A value of sigma too small will mean that the segmentation will be disturbed by the noise and staining pattern. Too high a sigma value, and the objects will be too blurred, making it harder to find their edges precisely and separate them later.  Run menu command: Process - Filters - Gaussian Blur, with a sigma value of 3 pixels. You can preview other values to see how they look also. You should get an image that looks like this:</li></ul>
<p><a href="File:NucleiDAPIconfocalGauss3pxSigma.png" class="image"><img alt="NucleiDAPIconfocalGauss3pxSigma.png" src="_images/0/0d/NucleiDAPIconfocalGauss3pxSigma.png" width="250" height="259" /></a>
</p>
<h3><span class="mw-headline" id="Pixel_Intensity_Threshold_-_find_the_foreground_areas">Pixel Intensity Threshold  - find the foreground areas</span></h3>
<ul><li> Next we need to separate the objects from the background using pixel intensity thresholding. Fiji has a number of built in <a href="Auto_Threshold" title="Auto Threshold">Automatic Thresholding</a> methods that try to distinguish the background from the foreground. In this case the default method works pretty well,  but you can see there is a long list of methods, which give slightly different threshold results for this image.  You can play with different methods if you like. You might get a different answer in the end!</li></ul>
<ul><li> Do menu command Image - Adjust - Threshold. Turn on the check box for "Dark background" . Indeed, in this case the background is dark! The default method will be previewed automatically when you launch the menu command, and a threshold will be set, something close to 100 intensity. If you are happy with the automatically calculate threshold, then click "Apply", which will give you a binary image.  Black is background, and white is foreground. It should look like this:</li></ul>
<p><a href="File:NucleiDAPIconfocalAutoDefaultThresh.png" class="image"><img alt="NucleiDAPIconfocalAutoDefaultThresh.png" src="_images/1/14/NucleiDAPIconfocalAutoDefaultThresh.png" width="250" height="259" /></a>
</p>
<ul><li> So far so good... But we still don't have objects... only background and foreground pixels.  Also it is clear that some nuclei are connected to adjacent ones... and we want them to be separated.  We will use the watershed method built into Fiji for that:</li></ul>
<h3><span class="mw-headline" id="Watershed_algorithm_-_separate_touching_objects">Watershed algorithm - separate touching objects</span></h3>
<ul><li> To run the built in <a rel="nofollow" class="external text" href="docs/menus/process.html#watershed">ImageJ watershed method</a> choose menu item: Process - Binary - Watershed. This method finds the centre of each object (using a morphological erode operation), then calculates a distance map from the object centre points to the edges of the objects, then fills that "topological map" with imaginary water. Where 2 "Watersheds" meet, it builds a dam to separate them! One could do all these steps manually, but the watershed function automates that for you, which is nice.  Your watershed image should look like this:</li></ul>
<p><a href="File:NucleiDAPIconfocalWatershed.png" class="image"><img alt="NucleiDAPIconfocalWatershed.png" src="_images/d/d4/NucleiDAPIconfocalWatershed.png" width="250" height="259" /></a>
</p>
<ul><li> Notice how the nuclei have been split away from each other.  This method only works robustly for roughly circular objects. Why?</li></ul>
<p><br />
</p>
<h3><span class="mw-headline" id="Analyze_the_segmented_objects">Analyze the segmented objects</span></h3>
<ul><li> Now you have a set of white foreground patches of white pixels, surrounded by black background pixel areas,  and we have separated touching objects with a watershed, which put "dams" one pixel wide between the objects. </li></ul>
<ul><li> Next we must run the Analyze Particles tool in Fiji to locate patches of white pixels and count them. But... that tool needs black objects on a white background or a threshold to be set on the image which contains the desired objects. To invert the image do Edit - Invert, or to threshold the binary image, again do Image - Adjust - Threshold (Since the image now contains only two intensities (0 and 255), the threshold default is of course correct,  and the objects appear in thresholded red, for black background again of course). </li></ul>
<ul><li> Now choose menu item Analyze - Analyze Particles,  using the settings in the screen shot below.</li></ul>
<p><a rel="nofollow" class="external text" href="http://imagejdocu.tudor.lu/doku.php?id=gui:analyze:analyze_particles">documentation for analyze particles.</a>
</p><p><a href="File:NulceiDAPIconfocalAnalyzeParticles.png" class="image"><img alt="NulceiDAPIconfocalAnalyzeParticles.png" src="_images/5/50/NulceiDAPIconfocalAnalyzeParticles.png" width="500" height="387" /></a>
</p>
<ul><li> You can filter out different sizes of particles. For example, you might only be interested in large objects,  like nuclei. So you can exclude small objects that you know are junk.  Change the area number range in the Size field and see what happens. </li></ul>
<ul><li> You can choose to count only those objects which are very circular by changing the Circularity range numbers to say 0.8-1. You could make it look for non circular objects too! How? Play with it, see what it does. </li></ul>
<ul><li> Use show outlines, or test the other options there if you like. Exclude on edges is very smart. It means you don't get nonsense results from objects that are chopped off at the edges of the image, and as such are of course smaller than they really are.</li></ul>
<ul><li> You can add all the objects to the ROI manager, by turning on Add to Manager.  Then you could use those ROIs to measure the intensities of the signal in the objects of the original image.  Can you figure out how to do that?</li></ul>
<ul><li> It also spits out lots of useful statistics: </li></ul>
<p><a href="File:NulceiDAPIconfocalSegmentationResults.png" class="image"><img alt="NulceiDAPIconfocalSegmentationResults.png" src="_images/9/9f/NulceiDAPIconfocalSegmentationResults.png" width="700" height="456" /></a>
</p>
<!-- 
NewPP limit report
Cached time: 20200713073046
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.032 seconds
Real time usage: 0.035 seconds
Preprocessor visited node count: 22/1000000
Preprocessor generated node count: 28/1000000
Postâ€expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/3
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 - -total
-->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="index.php?title=Nuclei_Watershed_Separation&amp;oldid=41299">http://imagej.net/index.php?title=Nuclei_Watershed_Separation&amp;oldid=41299</a>"</div>
							</div>

			<div id="footer">
				<p> This page was last modified on 24 January 2020, at 11:55.</p><ul><li><a href="ImageJ:Privacy_policy" title="ImageJ:Privacy policy">Privacy policy</a></li><li><a href="ImageJ:About" class="mw-redirect" title="ImageJ:About">About ImageJ</a></li><li><a href="Imprint" title="Imprint">Imprint</a></li><li><a href="index.php?title=Nuclei_Watershed_Separation&amp;mobileaction=toggle_view_mobile" class="noprint stopMobileRedirectToggle">Mobile view</a></li></ul>			</div>

			<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="Special:Categories" title="Special:Categories">Categories</a>: <ul><li><a href="Category:Tutorials" title="Category:Tutorials">Tutorials</a></li><li><a href="Category:Segmentation" title="Category:Segmentation">Segmentation</a></li></ul></div></div>		</div>

		<div id="bottom-wrap">
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.loader.load(["ext.fancytree","ext.suckerfish","mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","ext.SimpleTooltip"]);});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":226});});</script>
		</body>
		</html>
		